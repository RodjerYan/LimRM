// utils/addressMappings.ts

const capitalize = (str: string): string => {
    if (!str) return '';
    return str.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
};

/**
 * A map for normalizing common address typos and formatting variations.
 * This is applied first to clean the input string before parsing.
 */
export const CITY_NORMALIZATION_MAP: Record<string, string> = {
  'калининрад': 'калининград',
  'калининграл': 'калининград',
  'калиннградская': 'калининград',
  'снкт-петербург': 'санкт-петербург',
  'г гурьевск': 'гурьевск',
  'ул калининград': 'калининград',
  'б исаково': 'большое исаково',
  'пгт чкаловск': 'чкаловск',
};

/**
 * A comprehensive mapping of cities and towns to their respective regions.
 * This is the primary source for determining a region based on a found city.
 */
export const REGION_BY_CITY_MAP: Record<string, string> = {
  // === ПРОБЛЕМНЫЕ АДРЕСА ИЗ ЗАПРОСА ===
  'орёл': 'Орловская область',
  'орел': 'Орловская область',
  'мценск': 'Орловская область',
  'ливны': 'Орловская область',
  'болхов': 'Орловская область',
  'знаменка': 'Орловская область',
  'нарышкино': 'Орловская область',
  'зареченский': 'Орловская область',
  'жилина': 'Орловская область',
  'волково': 'Орловская область',
  'брянск': 'Брянская область',
  'сельцо': 'Брянская область',
  'смоленск': 'Смоленская область',
  'сафоново': 'Смоленская область',
  'людиново': 'Калужская область',
  'киров': 'Калужская область', // Defaulting to the one from user's example

  // === ОСНОВНЫЕ ГОРОДА РФ ===
  "москва": "Москва",
  "санкт-петербург": "Санкт-Петербург",
  "севастополь": "Севастополь",
  "абакан": "Республика Хакасия",
  "анадырь": "Чукотский автономный округ",
  "архангельск": "Архангельская область",
  "астрахань": "Астраханская область",
  "барнаул": "Алтайский край",
  "белгород": "Белгородская область",
  "биробиджан": "Еврейская автономная область",
  "благовещенск": "Амурская область",
  "владивосток": "Приморский край",
  "владикавказ": "Республика Северная Осетия — Алания",
  "владимир": "Владимирская область",
  "волгоград": "Волгоградская область",
  "вологда": "Вологодская область",
  "воронеж": "Воронежская область",
  "горно-алтайск": "Республика Алтай",
  "грозный": "Чеченская Республика",
  "екатеринбург": "Свердловская область",
  "иваново": "Ивановская область",
  "ижевск": "Удмуртская Республика",
  "иркутск": "Иркутская область",
  "йошкар-ола": "Республика Марий Эл",
  "казань": "Республика Татарстан",
  "калуга": "Калужская область",
  "кемерово": "Кемеровская область",
  "киров (калужская область)": "Калужская область",
  // "киров": "Кировская область", // This is ambiguous, handled by keyword map logic first
  "кострома": "Костромская область",
  "краснодар": "Краснодарский край",
  "красноярск": "Красноярский край",
  "курган": "Курганская область",
  "курск": "Курская область",
  "кызыл": "Республика Тыва",
  "липецк": "Липецкая область",
  "магадан": "Магаданская область",
  "магас": "Республика Ингушетия",
  "майкоп": "Республика Адыгея",
  "махачкала": "Республика Дагестан",
  "мурманск": "Мурманская область",
  "нальчик": "Кабардино-Балкарская Республика",
  "нарьян-мар": "Ненецкий автономный округ",
  "нижний новгород": "Нижегородская область",
  "новосибирск": "Новосибирская область",
  "омск": "Омская область",
  "оренбург": "Оренбургская область",
  "пенза": "Пензенская область",
  "пермь": "Пермский край",
  "петрозаводск": "Республика Карелия",
  "петропавловск-камчатский": "Камчатский край",
  "псков": "Псковская область",
  "ростов-на-дону": "Ростовская область",
  "рязань": "Рязанская область",
  "салехард": "Ямало-Ненецкий автономный округ",
  "самара": "Самарская область",
  "саранск": "Республика Мордовия",
  "саратов": "Саратовская область",
  "симферополь": "Республика Крым",
  "ставрополь": "Ставропольский край",
  "сыктывкар": "Республика Коми",
  "тамбов": "Тамбовская область",
  "тверь": "Тверская область",
  "томск": "Томская область",
  "тула": "Тульская область",
  "тюмень": "Тюменская область",
  "улан-удэ": "Республика Бурятия",
  "ульяновск": "Ульяновская область",
  "уфа": "Республика Башкортостан",
  "хабаровск": "Хабаровский край",
  "ханты-мансийск": "Ханты-Мансийский автономный округ - Югра",
  "чебоксары": "Чувашская Республика",
  "челябинск": "Челябинская область",
  "черкесск": "Карачаево-Черкесская Республика",
  "чита": "Забайкальский край",
  "элиста": "Республика Калмыкия",
  "южно-сахалинск": "Сахалинская область",
  "якутск": "Республика Саха (Якутия)",
  "ярославль": "Ярославская область",
  
  // === КАЛИНИНГРАДСКАЯ ОБЛАСТЬ ===
  'гвардейск': 'Калининградская область',
  'калининград': 'Калининградская область',
  'светлый': 'Калининградская область',
  'зеленоградск': 'Калининградская область',
  'гурьевск': 'Калининградская область',
  'пионерский': 'Калининградская область',
  'советск': 'Калининградская область',
  'светлогорск': 'Калининградская область',
  'багратионовск': 'Калининградская область',
  'черняховск': 'Калининградская область',
  'балтийск': 'Калининградская область',
  'правдинск': 'Калининградская область',
  'большое исаково': 'Калининградская область',
  'васильково': 'Калининградская область',
  'голубево': 'Калининградская область',
  'чкаловск': 'Калининградская область',

  // === САНКТ-ПЕТЕРБУРГ (ФЕДЕРАЛЬНЫЙ ГОРОД) ===
  'колпино': 'Санкт-Петербург',
  'пушкин': 'Санкт-Петербург',
  'петергоф': 'Санкт-Петербург',
  'сестрорецк': 'Санкт-Петербург',
  'кронштадт': 'Санкт-Петербург',
  'ломоносов': 'Санкт-Петербург',

  // === ЛЕНИНГРАДСКАЯ ОБЛАСТЬ ===
  'всеволожск': 'Ленинградская область',
  'выборг': 'Ленинградская область',
  'гатчина': 'Ленинградская область',
  'сосновый бор': 'Ленинградская область',
  'кировск': 'Ленинградская область',
  'тосно': 'Ленинградская область',
  'кудрово': 'Ленинградская область',
  'мурино': 'Ленинградская область',
  'коммунар': 'Ленинградская область',
  'тихвин': 'Ленинградская область',
  'сланцы': 'Ленинградская область',
  'приозерск': 'Ленинградская область',
  'волхов': 'Ленинградская область',
  'кириши': 'Ленинградская область',
  'луга': 'Ленинградская область',

  // === НОВГОРОДСКАЯ ОБЛАСТЬ ===
  'великий новгород': 'Новгородская область',

  // === КАБАРДИНО-БАЛКАРИЯ ===
  'майский': 'Кабардино-Балкарская Республика',
  'александровская': 'Кабардино-Балкарская Республика',

  // === СТРАНЫ СНГ (Пример) ===
  "минск": "Республика Беларусь",
  "гомель": "Республика Беларусь",
  "астана": "Республика Казахстан",
  "алматы": "Республика Казахстан",
};


export const REGION_KEYWORD_MAP: Record<string, string> = {
  // Короткие и неоднозначные сокращения, которые теперь ищутся как отдельные слова
  'ло': 'Ленинградская область',
  'лен обл': 'Ленинградская область',
  'спб': 'Санкт-Петербург',
  'кал-я обл': 'Калининградская область',
  
  // Полные и частичные названия регионов
  'адыгея': 'Республика Адыгея',
  'алтай респ': 'Республика Алтай',
  'башкортостан': 'Республика Башкортостан', 'башкирия': 'Республика Башкортостан',
  'бурятия': 'Республика Бурятия',
  'дагестан': 'Республика Дагестан',
  'ингушетия': 'Республика Ингушетия',
  'кбр': 'Кабардино-Балкарская Республика', 'кабардино-балкарская': 'Кабардино-Балкарская Республика',
  'калмыкия': 'Республика Калмыкия',
  'кчр': 'Карачаево-Черкесская Республика', 'карачаево-черкесская': 'Карачаево-Черкесская Республика',
  'карелия': 'Республика Карелия',
  'коми': 'Республика Коми',
  'крым': 'Республика Крым',
  'марий эл': 'Республика Марий Эл',
  'мордовия': 'Республика Мордовия',
  'саха': 'Республика Саха (Якутия)', 'якутия': 'Республика Саха (Якутия)',
  'северная осетия': 'Республика Северная Осетия — Алания', 'алания': 'Республика Северная Осетия — Алания',
  'татарстан': 'Республика Татарстан',
  'тыва': 'Республика Тыва', 'тува': 'Республика Тыва',
  'удмуртия': 'Удмуртская Республика',
  'хакасия': 'Республика Хакасия',
  'чечня': 'Чеченская Республика', 'чеченская': 'Чеченская Республика',
  'чувашия': 'Чувашская Республика', 'чувашская': 'Чувашская Республика',
  'алтайский край': 'Алтайский край',
  'забайкальский край': 'Забайкальский край',
  'камчатский край': 'Камчатский край',
  'краснодарский край': 'Краснодарский край', 'кубань': 'Краснодарский край',
  'красноярский край': 'Красноярский край',
  'пермский край': 'Пермский край',
  'приморский край': 'Приморский край',
  'ставропольский край': 'Ставропольский край',
  'хабаровский край': 'Хабаровский край',
  'амурская обл': 'Амурская область', 'амурская область': 'Амурская область', 'обл амурская': 'Амурская область', 'амурская': 'Амурская область',
  'архангельская обл': 'Архангельская область', 'архангельская область': 'Архангельская область', 'обл архангельская': 'Архангельская область', 'архангельская': 'Архангельская область',
  'астраханская обл': 'Астраханская область', 'астраханская область': 'Астраханская область', 'обл астраханская': 'Астраханская область', 'астраханская': 'Астраханская область',
  'белгородская обл': 'Белгородская область', 'белгородская область': 'Белгородская область', 'обл белгородская': 'Белгородская область', 'белгородская': 'Белгородская область',
  'брянская обл': 'Брянская область', 'брянская область': 'Брянская область', 'обл брянская': 'Брянская область', 'брянская': 'Брянская область', 'г брянск': 'Брянская область',
  'владимирская обл': 'Владимирская область', 'владимирская область': 'Владимирская область', 'обл владимирская': 'Владимирская область', 'владимирская': 'Владимирская область',
  'волгоградская обл': 'Волгоградская область', 'волгоградская область': 'Волгоградская область', 'обл волгоградская': 'Волгоградская область', 'волгоградская': 'Волгоградская область',
  'вологодская обл': 'Вологодская область', 'вологодская область': 'Вологодская область', 'обл вологодская': 'Вологодская область', 'вологодская': 'Вологодская область',
  'воронежская обл': 'Воронежская область', 'воронежская область': 'Воронежская область', 'обл воронежская': 'Воронежская область', 'воронежская': 'Воронежская область',
  'ивановская обл': 'Ивановская область', 'ивановская область': 'Ивановская область', 'обл ивановская': 'Ивановская область', 'ивановская': 'Ивановская область',
  'иркутская обл': 'Иркутская область', 'иркутская область': 'Иркутская область', 'обл иркутская': 'Иркутская область', 'иркутская': 'Иркутская область',
  'калининградская обл': 'Калининградская область', 'калининградская область': 'Калининградская область', 'обл калининградская': 'Калининградская область', 'калининградская': 'Калининградская область',
  'калужская обл': 'Калужская область', 'калужская область': 'Калужская область', 'обл калужская': 'Калужская область', 'калужская': 'Калужская область', 'г киров': 'Калужская область',
  'кемеровская обл': 'Кемеровская область', 'кемеровская область': 'Кемеровская область', 'обл кемеровская': 'Кемеровская область', 'кемеровская': 'Кемеровская область', 'кузбасс': 'Кемеровская область',
  'кировская обл': 'Кировская область', 'кировская область': 'Кировская область', 'обл кировская': 'Кировская область', 'кировская': 'Кировская область',
  'костромская обл': 'Костромская область', 'костромская область': 'Костромская область', 'обл костромская': 'Костромская область', 'костромская': 'Костромская область',
  'курганская обл': 'Курганская область', 'курганская область': 'Курганская область', 'обл курганская': 'Курганская область', 'курганская': 'Курганская область',
  'курская обл': 'Курская область', 'курская область': 'Курская область', 'обл курская': 'Курская область', 'курская': 'Курская область',
  'ленинградская обл': 'Ленинградская область', 'ленинградская область': 'Ленинградская область', 'обл ленинградская': 'Ленинградская область', 'ленинградская': 'Ленинградская область',
  'липецкая обл': 'Липецкая область', 'липецкая область': 'Липецкая область', 'обл липецкая': 'Липецкая область', 'липецкая': 'Липецкая область',
  'магаданская обл': 'Магаданская область', 'магаданская область': 'Магаданская область', 'обл магаданская': 'Магаданская область', 'магаданская': 'Магаданская область',
  'московская обл': 'Московская область', 'московская область': 'Московская область', 'обл московская': 'Московская область', 'московская': 'Московская область', 'мособласть': 'Московская область', 'подмосковье': 'Московская область',
  'мурманская обл': 'Мурманская область', 'мурманская область': 'Мурманская область', 'обл мурманская': 'Мурманская область', 'мурманская': 'Мурманская область',
  'нижегородская обл': 'Нижегородская область', 'нижегородская область': 'Нижегородская область', 'обл нижегородская': 'Нижегородская область', 'нижегородская': 'Нижегородская область',
  'новгородская обл': 'Новгородская область', 'новгородская область': 'Новгородская область', 'обл новгородская': 'Новгородская область', 'новгородская': 'Новгородская область',
  'новосибирская обл': 'Новосибирская область', 'новосибирская область': 'Новосибирская область', 'обл новосибирская': 'Новосибирская область', 'новосибирская': 'Новосибирская область',
  'омская обл': 'Омская область', 'омская область': 'Омская область', 'обл омская': 'Омская область', 'омская': 'Омская область',
  'оренбургская обл': 'Оренбургская область', 'оренбургская область': 'Оренбургская область', 'обл оренбургская': 'Оренбургская область', 'оренбургская': 'Оренбургская область',
  'орловская обл': 'Орловская область', 'орловская область': 'Орловская область', 'обл орловская': 'Орловская область', 'орловская': 'Орловская область', 'г орёл': 'Орловская область', 'г орел': 'Орловская область',
  'пензенская обл': 'Пензенская область', 'пензенская область': 'Пензенская область', 'обл пензенская': 'Пензенская область', 'пензенская': 'Пензенская область',
  'псковская обл': 'Псковская область', 'псковская область': 'Псковская область', 'обл псковская': 'Псковская область', 'псковская': 'Псковская область',
  'ростовская обл': 'Ростовская область', 'ростовская область': 'Ростовская область', 'обл ростовская': 'Ростовская область', 'ростовская': 'Ростовская область',
  'рязанская обл': 'Рязанская область', 'рязанская область': 'Рязанская область', 'обл рязанская': 'Рязанская область', 'рязанская': 'Рязанская область',
  'самарская обл': 'Самарская область', 'самарская область': 'Самарская область', 'обл самарская': 'Самарская область', 'самарская': 'Самарская область',
  'саратовская обл': 'Саратовская область', 'саратовская область': 'Саратовская область', 'обл саратовская': 'Саратовская область', 'саратовская': 'Саратовская область',
  'сахалинская обл': 'Сахалинская область', 'сахалинская область': 'Сахалинская область', 'обл сахалинская': 'Сахалинская область', 'сахалинская': 'Сахалинская область',
  'свердловская обл': 'Свердловская область', 'свердловская область': 'Свердловская область', 'обл свердловская': 'Свердловская область', 'свердловская': 'Свердловская область',
  'смоленская обл': 'Смоленская область', 'смоленская область': 'Смоленская область', 'обл смоленская': 'Смоленская область', 'смоленская': 'Смоленская область', 'г смоленск': 'Смоленская область',
  'тамбовская обл': 'Тамбовская область', 'тамбовская область': 'Тамбовская область', 'обл тамбовская': 'Тамбовская область', 'тамбовская': 'Тамбовская область',
  'тверская обл': 'Тверская область', 'тверская область': 'Тверская область', 'обл тверская': 'Тверская область', 'тверская': 'Тверская область',
  'томская обл': 'Томская область', 'томская область': 'Томская область', 'обл томская': 'Томская область', 'томская': 'Томская область',
  'тульская обл': 'Тульская область', 'тульская область': 'Тульская область', 'обл тульская': 'Тульская область', 'тульская': 'Тульская область',
  'тюменская обл': 'Тюменская область', 'тюменская область': 'Тюменская область', 'обл тюменская': 'Тюменская область', 'тюменская': 'Тюменская область',
  'ульяновская обл': 'Ульяновская область', 'ульяновская область': 'Ульяновская область', 'обл ульяновская': 'Ульяновская область', 'ульяновская': 'Ульяновская область',
  'челябинская обл': 'Челябинская область', 'челябинская область': 'Челябинская область', 'обл челябинская': 'Челябинская область', 'челябинская': 'Челябинская область',
  'ярославская обл': 'Ярославская область', 'ярославская область': 'Ярославская область', 'обл ярославская': 'Ярославская область', 'ярославская': 'Ярославская область',
  'запорожская обл': 'Запорожская область', 'запорожская': 'Запорожская область',
  'херсонская обл': 'Херсонская область', 'херсонская': 'Херсонская область',
  'москва': 'Москва',
  'санкт-петербург': 'Санкт-Петербург',
  'севастополь': 'Севастополь',
  'ненецкий ао': 'Ненецкий автономный округ',
  'хмао': 'Ханты-Мансийский автономный округ - Югра', 'югра': 'Ханты-Мансийский автономный округ - Югра',
  'чукотский ао': 'Чукотский автономный округ', 'чукотка': 'Чукотский автономный округ',
  'янао': 'Ямало-Ненецкий автономный округ', 'ямал': 'Ямало-Ненецкий автономный округ',
  'еврейская ао': 'Еврейская автономная область',
  // СНГ
  'беларусь': 'Республика Беларусь', 'белоруссия': 'Республика Беларусь',
  'казахстан': 'Республика Казахстан',
  'армения': 'Армения',
  'киргизия': 'Кыргызская Республика', 'кыргызстан': 'Кыргызская Республика',
};


export const INDEX_MAP: Record<string, string> = {
    // Префиксы индексов
    '241': 'Брянская область', '242': 'Брянская область', '243': 'Брянская область',
    '302': 'Орловская область', '303': 'Орловская область',
    '214': 'Смоленская область', '215': 'Смоленская область', '216': 'Смоленская область',
    '236': 'Калининградская область', '238': 'Калининградская область',
    '295': 'Республика Крым', '296': 'Республика Крым', '297': 'Республика Крым', '298': 'Республика Крым',
    '350': 'Краснодарский край', '352': 'Краснодарский край', '353': 'Краснодарский край',
    '101': 'Москва', '102': 'Москва', '103': 'Москва', '104': 'Москва', '105': 'Москва', '106': 'Москва', '107': 'Москва', '108': 'Москва', '109': 'Москва', '111': 'Москва', '115': 'Москва', '117': 'Москва', '119': 'Москва', '121': 'Москва', '123': 'Москва', '124': 'Москва', '125': 'Москва', '127': 'Москва', '129': 'Москва', '131': 'Москва', '133': 'Москва', '135': 'Москва',
    '140': 'Московская область', '141': 'Московская область', '142': 'Московская область', '143': 'Московская область',
    '187': 'Ленинградская область', '188': 'Ленинградская область',
    '190': 'Санкт-Петербург', '191': 'Санкт-Петербург', '192': 'Санкт-Петербург', '193': 'Санкт-Петербург', '194': 'Санкт-Петербург', '195': 'Санкт-Петербург', '196': 'Санкт-Петербург', '197': 'Санкт-Петербург', '198': 'Санкт-Петербург',
    '173': 'Новгородская область',
    '361': 'Кабардино-Балкарская Республика',
    '249': 'Калужская область',
};

/**
 * Standardizes a region name to a consistent format.
 * Ensures the final output is clean, capitalized, and matches the official name.
 * @param input The detected region string.
 * @returns A standardized region name or the default "Регион не определен".
 */
export const standardizeRegion = (input: string | null | undefined): string => {
    if (!input) return 'Регион не определен';
    
    // The maps already contain the standardized names. This function primarily acts as a final formatter.
    const cleanInput = input.trim();
    
    // Check if the input is already a standardized value from our maps
    const allStandardValues = new Set([...Object.values(REGION_BY_CITY_MAP), ...Object.values(REGION_KEYWORD_MAP)]);
    if (allStandardValues.has(cleanInput)) {
        return cleanInput;
    }

    // Capitalize and return as a last resort
    return capitalize(cleanInput);
};