
// utils/addressMappings.ts

// FIX: Export REGION_BY_CITY_MAP to resolve the compilation error in `dataUtils.ts`.
// This map is derived from the comprehensive REGION_BY_CITY_WITH_INDEXES data source,
// providing a simple city-to-region lookup as intended by the application's design.
import { REGION_BY_CITY_WITH_INDEXES } from './regionMap';

/**
 * A simple city-to-region map derived from the more detailed REGION_BY_CITY_WITH_INDEXES.
 * This is used for quick lookups where only the region is needed.
 */
export const REGION_BY_CITY_MAP: Record<string, string> = Object.fromEntries(
    Object.entries(REGION_BY_CITY_WITH_INDEXES).map(([city, data]) => [city, data.region])
);

const capitalize = (str: string): string => {
    if (!str) return '';
    return str.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
};

/**
 * A map for normalizing common address typos and formatting variations.
 * This is applied first to clean the input string before parsing.
 */
export const CITY_NORMALIZATION_MAP: Record<string, string> = {
  'калининрад': 'калининград',
  'калининграл': 'калининград',
  'калиннградская': 'калининград',
  'г красноадр': 'краснодар', // FIX for typo
  'снкт-петербург': 'санкт-петербург',
  'г,гурьевск': 'гурьевск',
  'г гурьевск': 'гурьевск',
  'ул калининград': 'калининград',
  'б исаково': 'большое исаково',
  'пгт чкаловск': 'чкаловск',
  'макевка': 'макеевка',
  'ленинградска обл': 'ленинградская область',
  'лениенградская обл': 'ленинградская область',
  'г. сланца': 'сланцы',
  'в.новгород': 'великий новгород',
  'г. макее': 'макеевка',
  'г.мариуп': 'мариуполь',
  'г. мелиополь': 'мелитополь',
  'г мелиополь': 'мелитополь',
  'г. лугаснк': 'луганск',
  'мелиопольул': 'мелитополь',
  'комсомолькое': 'комсомольское',
  'санкт-петеребург': 'санкт-петербург',
  'г сакнт-петербург': 'санкт-Петербург',
  'гсанкт-петербург': 'санкт-петербург',
  'ст-ца': '',
  'ст.': '',
  'ст ': '',
  'х.': '',
  'х ': '',
  'пгт': '',
  'поселок': '',
  'пос.': '',
  'пос ': '',
  'село': '',
  'с.': '',
  'с ': ''
};

export const REGION_KEYWORD_MAP: Record<string, string> = {
  // Города как синонимы регионов (для столбца Субъект)
  // FIX: Added robust variations for Orel and other common city-as-region cases based on feedback
  'орел': 'Орловская область',
  'орёл': 'Орловская область',
  'г орел': 'Орловская область',
  'г орёл': 'Орловская область',
  'г.орел': 'Орловская область',
  'г.орёл': 'Орловская область',
  'орел г': 'Орловская область',
  'орёл г': 'Орловская область',
  'орловская': 'Орловская область',
  'орловская обл': 'Орловская область',
  'орловская область': 'Орловская область',
  'orel': 'Орловская область',

  'абхазия': 'Республика Абхазия',
  'апсны': 'Республика Абхазия',
  'abkhazia': 'Республика Абхазия',
  'пмр': 'Приднестровье',
  'приднестровская': 'Приднестровье',
  'приднестровье': 'Приднестровье',
  'transnistria': 'Приднестровье',
  'pridnestrovie': 'Приднестровье',
  'южная осетия': 'Республика Южная Осетия',
  'юор': 'Республика Южная Осетия',
  'рью': 'Республика Южная Осетия',
  'south ossetia': 'Республика Южная Осетия',

  // Новые регионы
  'луганская народная респ': 'Луганская Народная Республика',
  'луганская респ': 'Луганская Народная Республика',
  'лнр': 'Луганская Народная Республика',
  'донецкая народная респ': 'Донецкая Народная Республика',
  'донецкая респ': 'Донецкая Народная Республика',
  'днр': 'Донецкая Народная Республика',
  'рсо-алания': 'Республика Северная Осетия — Алания',
  'чр': 'Чеченская Республика',
  
  // Районы ( Districts ) - very reliable identifier
  'гурьевский р-н': 'Калининградская область',
  'ломоносовский р-н': 'Ленинградская область',
  'гатчинский р-н': 'Ленинградская область',
  'гатчинский район': 'Ленинградская область',
  'всеволожский р-н': 'Ленинградская область',
  'всеволожский район': 'Ленинградская область',
  'тосненский р-н': 'Ленинградская область',
  'тосненский район': 'Ленинградская область',
  'выборгский р-н': 'Ленинградская область', // Может быть и в СПб, но чаще в ЛО
  'красносельский район': 'Санкт-Петербург',
  'колпинский': 'Санкт-Петербург',
  'волосовский район': 'Ленинградская область',
  'пушкинский район': 'Санкт-Петербург',
  'кировский район': 'Ленинградская область',
  'новгородский р-н': 'Новгородская область',
  'валдайский р-н': 'Новгородская область',
  'волновахский р-н': 'Донецкая Народная Республика',
  'станично-луганский': 'Луганская Народная Республика',
  'краснодарский кр': 'Краснодарский край',
  'кк': 'Краснодарский край',
  'динской р-н': 'Краснодарский край',
  'адлерский район': 'Краснодарский край',
  'гулькевичевский р-н': 'Краснодарский край',
  'анапский р-н': 'Краснодарский край',
  'темрюкский р-н': 'Краснодарский край',
  'северский р-н': 'Краснодарский край',
  'курганинский район': 'Краснодарский край',
  'тихорецкий район': 'Краснодарский край',
  'красноармейский р-н': 'Краснодарский край',
  'апшеронский р-н': 'Краснодарский край',
  'тимашевский р-н': 'Краснодарский край',
  'павловский р-н': 'Краснодарский край',
  'каневской район': 'Краснодарский край',
  'туапсинский р-н': 'Краснодарский край',
  'ейский р-н': 'Краснодарский край',
  'симферопольский р-н': 'Республика Крым',
  'белогорский р-н': 'Республика Крым',
  'сакский р-н': 'Республика Крым',
  'красногвардейский р-н': 'Республика Крым',
  'минераловодский район': 'Ставропольский край',
  'буденновский р-н': 'Ставропольский край',
  'аннинское городское поселение': 'Ленинградская область',
  'пудомягское сельское поселение': 'Ленинградская область',
  'рощинское': 'Ленинградская область',
  
  // Расширенные районы для проблемных областей (Кировская, Орловская и т.д.)
  'слободской р-н': 'Кировская область',
  'слободской район': 'Кировская область',
  'вятскополянский р-н': 'Кировская область',
  'вятскополянский район': 'Кировская область',
  'котельничский р-н': 'Кировская область',
  'котельничский район': 'Кировская область',
  'кирово-чепецкий р-н': 'Кировская область',
  'кирово-чепецкий район': 'Кировская область',
  'орловский р-н': 'Орловская область', // Контекст важен, но обычно это пригород Орла
  'ливенский р-н': 'Орловская область',
  'мценский р-н': 'Орловская область',
  'брянский р-н': 'Брянская область',
  'клинцовский р-н': 'Брянская область',
  'новозыбковский р-н': 'Брянская область',
  'смоленский р-н': 'Смоленская область',
  'вяземский р-н': 'Смоленская область', // Есть и в Хабаровском, но по приоритету ближе к центру РФ
  'рославльский р-н': 'Смоленская область',
  'калужский р-н': 'Калужская область',
  'боровский р-н': 'Калужская область',
  'малоярославецкий р-н': 'Калужская область',


  // Короткие и неоднозначные сокращения, которые теперь ищутся как отдельные слова
  'ло': 'Ленинградская область',
  'лен обл': 'Ленинградская область',
  'спб': 'Санкт-Петербург',
  'петербург': 'Санкт-Петербург',
  'кал-я обл': 'Калининградская область',
  
  'смоленск': 'Смоленская область', 'г смоленск': 'Смоленская область', 'смоленская': 'Смоленская область',
  'тула': 'Тульская область', 'г тула': 'Тульская область', 'тульская': 'Тульская область',
  'калуга': 'Калужская область', 'г калуга': 'Калужская область', 'калужская': 'Калужская область',
  'брянск': 'Брянская область', 'г брянск': 'Брянская область', 'брянская': 'Брянская область',
  'владимир': 'Владимирская область', 'г владимир': 'Владимирская область', 'владимирская': 'Владимирская область',
  'рязань': 'Рязанская область', 'г рязань': 'Рязанская область', 'рязанская': 'Рязанская область',
  'курск': 'Курская область', 'г курск': 'Курская область', 'курская': 'Курская область',
  'липецк': 'Липецкая область', 'г липецк': 'Липецкая область', 'липецкая': 'Липецкая область',
  'тамбов': 'Тамбовская область', 'г тамбов': 'Тамбовская область', 'тамбовская': 'Тамбовская область',
  'белгород': 'Белгородская область', 'г белгород': 'Белгородская область', 'белгородская': 'Белгородская область',
  'воронеж': 'Воронежская область', 'г воронеж': 'Воронежская область', 'воронежская': 'Воронежская область',
  'кострома': 'Костромская область', 'г кострома': 'Костромская область', 'костромская': 'Костромская область',
  'ярославль': 'Ярославская область', 'г ярославль': 'Ярославская область', 'ярославская': 'Ярославская область',
  'тверь': 'Тверская область', 'г тверь': 'Тверская область', 'тверская': 'Тверская область',
  'вологда': 'Вологодская область', 'г вологда': 'Вологодская область', 'вологодская': 'Вологодская область',
  'киров': 'Кировская область', 'г киров': 'Кировская область', 'кировская': 'Кировская область',
  'пенза': 'Пензенская область', 'г пенза': 'Пензенская область', 'пензенская': 'Пензенская область',
  'саратов': 'Саратовская область', 'г саратов': 'Саратовская область', 'саратовская': 'Саратовская область',
  'самара': 'Самарская область', 'г самара': 'Самарская область', 'самарская': 'Самарская область',
  'ульяновск': 'Ульяновская область', 'г ульяновск': 'Ульяновская область', 'ульяновская': 'Ульяновская область',
  'оренбург': 'Оренбургская область', 'г оренбург': 'Оренбургская область', 'оренбургская': 'Оренбургская область',
  'нижний новгород': 'Нижегородская область', 'г нижний новгород': 'Нижегородская область', 'нижегородская': 'Нижегородская область',
  'великий новгород': 'Новгородская область', 'г великий новгород': 'Новгородская область', 'новгородская': 'Новгородская область',
  'псков': 'Псковская область', 'г псков': 'Псковская область', 'псковская': 'Псковская область',
  'калининград': 'Калининградская область', 'г калининград': 'Калининградская область', 'калининградская': 'Калининградская область',
  'мурманск': 'Мурманская область', 'г мурманск': 'Мурманская область', 'мурманская': 'Мурманская область',
  'архангельск': 'Архангельская область', 'г архангельск': 'Архангельская область', 'архангельская': 'Архангельская область',
  'астрахань': 'Астраханская область', 'г астрахань': 'Астраханская область', 'астраханская': 'Астраханская область',
  'волгоград': 'Волгоградская область', 'г волгоград': 'Волгоградская область', 'волгоградская': 'Волгоградская область',
  'челябинск': 'Челябинская область', 'г челябинск': 'Челябинская область', 'челябинская': 'Челябинская область',
  'екатеринбург': 'Свердловская область', 'г екатеринбург': 'Свердловская область', 'свердловская': 'Свердловская область',
  'тюмень': 'Тюменская область', 'г тюмень': 'Тюменская область', 'тюменская': 'Тюменская область',
  'курган': 'Курганская область', 'г курган': 'Курганская область', 'курганская': 'Курганская область',
  'омск': 'Омская область', 'г омск': 'Омская область', 'омская': 'Омская область',
  'новосибирск': 'Новосибирская область', 'г новосибирск': 'Новосибирская область', 'новосибирская': 'Новосибирская область',
  'томск': 'Томская область', 'г томск': 'Томская область', 'томская': 'Томская область',
  'кемерово': 'Кемеровская область', 'г кемерово': 'Кемеровская область', 'кемеровская': 'Кемеровская область',
  'иркутск': 'Иркутская область', 'г иркутск': 'Иркутская область', 'иркутская': 'Иркутская область',
  'магадан': 'Магаданская область', 'г магадан': 'Магаданская область', 'магаданская': 'Магаданская область',
  'тирасполь': 'Приднестровье', 'бендеры': 'Приднестровье', 'рыбница': 'Приднестровье',
  'цхинвал': 'Республика Южная Осетия', 'цхинвали': 'Республика Южная Осетия',
  
  // Полные и частичные названия регионов
  'адыгея': 'Республика Адыгея',
  'алтай респ': 'Республика Алтай',
  'башкортостан': 'Республика Башкортостан', 'башкирия': 'Республика Башкортостан',
  'бурятия': 'Республика Бурятия',
  'дагестан': 'Республика Дагестан',
  'ингушетия': 'Республика Ингушетия',
  'кбр': 'Кабардино-Bалкарская Республика', 'кабардино-балкарская': 'Кабардино-Балкарская Республика',
  'калмыкия': 'Республика Калмыкия',
  'кчр': 'Карачаево-Черкесская Республика', 'карачаево-черкесская': 'Карачаево-Черкесская Республика',
  'карелия': 'Республика Карелия',
  'коми': 'Республика Коми',
  'крым': 'Республика Крым',
  'марий эл': 'Республика Марий Эл',
  'мордовия': 'Республика Мордовия',
  'саха': 'Республика Саха (Якутия)', 'якутия': 'Республика Саха (Якутия)',
  'северная осетия': 'Республика Северная Осетия — Алания', 'алания': 'Республика Северная Осетия — Алания',
  'татарстан': 'Республика Татарстан',
  'тыва': 'Республика Тыва', 'тува': 'Республика Тыва',
  'удмуртия': 'Удмуртская Республика',
  'хакасия': 'Республика Хакасия',
  'чечня': 'Чеченская Республика',
  'чувашия': 'Чувашская Республика',
  'алтайский край': 'Алтайский край',
  'забайкальский край': 'Забайкальский край',
  'камчатский край': 'Камчатский край',
  'краснодарский край': 'Краснодарский край', 'кубань': 'Краснодарский край',
  'красноярский край': 'Красноярский край',
  'пермский край': 'Пермский край',
  'приморский край': 'Приморский край',
  'ставропольский край': 'Ставропольский край',
  'хабаровский край': 'Хабаровский край',
  'амурская обл': 'Амурская область', 'амурская область': 'Амурская область', 'обл амурская': 'Амурская область',
  'архангельская обл': 'Архангельская область', 'архангельская область': 'Архангельская область', 'обл архангельская': 'Архангельская область',
  'астраханская обл': 'Астраханская область', 'астраханская область': 'Астраханская область', 'обл астраханская': 'Астраханская область',
  'белгородская обл': 'Белгородская область', 'белгородская область': 'Белгородская область', 'обл белгородская': 'Белгородская область',
  'брянская обл': 'Брянская область', 'брянская область': 'Брянская область', 'обл брянская': 'Брянская область',
  'владимирская обл': 'Владимирская область', 'владимирская область': 'Владимирская область', 'обл владимирская': 'Владимирская область',
  'волгоградская обл': 'Волгоградская область', 'волгоградская область': 'Волгоградская область', 'обл волгоградская': 'Волгоградская область',
  'вологодская обл': 'Вологодская область', 'вологодская область': 'Вологодская область', 'обл вологодская': 'Вологодская область',
  'воронежская обл': 'Воронежская область', 'воронежская область': 'Воронежская область', 'обл воронежская': 'Воронежская область',
  'ивановская обл': 'Ивановская область', 'ивановская область': 'Ивановская область', 'обл ивановская': 'Ивановская область',
  'иркутская обл': 'Иркутская область', 'иркутская область': 'Иркутская область', 'обл иркутская': 'Иркутская область',
  'калининградская обл': 'Калининградская область', 'калининградская область': 'Калининградская область', 'обл калининградская': 'Калининградская область',
  'калужская обл': 'Калужская область', 'калужская область': 'Калужская область', 'обл калужская': 'Калужская область',
  'кемеровская обл': 'Кемеровская область', 'кемеровская область': 'Кемеровская область', 'обл кемеровская': 'Кемеровская область', 'кузбасс': 'Кемеровская область',
  'кировская обл': 'Кировская область', 'кировская область': 'Кировская область', 'обл кировская': 'Кировская область',
  'костромская обл': 'Костромская область', 'костромская область': 'Костромская область', 'обл костромская': 'Костромская область',
  'курганская обл': 'Курганская область', 'курганская область': 'Курганская область', 'обл курганская': 'Курганская область',
  'курская обл': 'Курская область', 'курская область': 'Курская область', 'обл курская': 'Курская область',
  'ленинградская обл': 'Ленинградская область', 'ленинградская область': 'Ленинградская область', 'обл ленинградская': 'Ленинградская область',
  'липецкая обл': 'Липецкая область', 'липецкая область': 'Липецкая область', 'обл липецкая': 'Липецкая область',
  'магаданская обл': 'Магаданская область', 'магаданская область': 'Магаданская область', 'обл магаданская': 'Магаданская область',
  'московская обл': 'Московская область', 'московская область': 'Московская область', 'обл московская': 'Московская область', 'мособласть': 'Московская область', 'подмосковье': 'Московская область',
  'мурманская обл': 'Мурманская область', 'мурманская область': 'Мурманская область', 'обл мурманская': 'Мурманская область',
  'нижегородская обл': 'Нижегородская область', 'нижегородская область': 'Нижегородская область', 'обл нижегородская': 'Нижегородская область',
  'новгородская обл': 'Новгородская область', 'новгородская область': 'Новгородская область', 'обл новгородская': 'Новгородская область',
  'новосибирская обл': 'Новосибирская область', 'новосибирская область': 'Новосибирская область', 'обл новосибирская': 'Новосибирская область',
  'омская обл': 'Омская область', 'омская область': 'Омская область', 'обл омская': 'Омская область',
  'оренбургская обл': 'Оренбургская область', 'оренбургская область': 'Оренбургская область', 'обл оренбургская': 'Оренбургская область',
  'пензенская обл': 'Пензенская область', 'пензенская область': 'Пензенская область', 'обл пензенская': 'Пензенская область',
  'псковская обл': 'Псковская область', 'псковская область': 'Псковская область', 'обл псковская': 'Псковская область',
  'ростовская обл': 'Ростовская область', 'ростовская область': 'Ростовская область', 'обл ростовская': 'Ростовская область',
  'рязанская обл': 'Рязанская область', 'рязанская область': 'Рязанская область', 'обл рязанская': 'Рязанская область',
  'самарская обл': 'Самарская область', 'самарская область': 'Самарская область', 'обл самарская': 'Самарская область',
  'саратовская обл': 'Саратовская область', 'саратовская область': 'Саратовская область', 'обл саратовская': 'Саратовская область',
  'сахалинская обл': 'Сахалинская область', 'сахалинская область': 'Сахалинская область', 'обл сахалинская': 'Сахалинская область',
  'свердловская обл': 'Свердловская область', 'свердловская область': 'Свердловская область', 'обл свердловская': 'Свердловская область',
  'смоленская обл': 'Смоленская область', 'смоленская область': 'Смоленская область', 'обл смоленская': 'Смоленская область',
  'тамбовская обл': 'Тамбовская область', 'тамбовская область': 'Тамбовская область', 'обл тамбовская': 'Тамбовская область',
  'тверская обл': 'Тверская область', 'тверская область': 'Тверская область', 'обл тверская': 'Тверская область',
  'томская обл': 'Томская область', 'томская область': 'Томская область', 'обл томская': 'Томская область',
  'тульская обл': 'Тульская область', 'тульская область': 'Тульская область', 'обл тульская': 'Тульская область',
  'тюменская обл': 'Тюменская область', 'тюменская область': 'Тюменская область', 'обл тюменская': 'Тюменская область',
  'ульяновская обл': 'Ульяновская область', 'ульяновская область': 'Ульяновская область', 'обл ульяновская': 'Ульяновская область',
  'челябинская обл': 'Челябинская область', 'челябинская область': 'Челябинская область', 'обл челябинская': 'Челябинская область',
  'ярославская обл': 'Ярославская область', 'ярославская область': 'Ярославская область', 'обл ярославская': 'Ярославская область',
  'запорожская обл': 'Запорожская область', 'обл запорожская': 'Запорожская область',
  'херсонская обл': 'Херсонская область', 'обл херсонская': 'Херсонская область',
  'ненецкий ао': 'Ненецкий автономный округ',
  'хмао': 'Ханты-Мансийский автономный округ — Югра', 'югра': 'Ханты-Мансийский автономный округ — Югра',
  'чукотский ао': 'Чукотский автономный округ', 'чукотка': 'Чукотский автономный округ',
  'янао': 'Ямало-Ненецкий автономный округ', 'ямал': 'Ямало-Ненецкий автономный округ',
  'еврейская ао': 'Еврейская автономная область',
  
  // СНГ
  'беларусь': 'Республика Беларусь', 'белоруссия': 'Республика Беларусь',
  'казахстан': 'Республика Казахстан',
  'алматинская область': 'Республика Казахстан',
  'мангистауская обл': 'Республика Казахстан',

  // Украина
  'украина': 'Украина',
  'киев': 'Киев',
  'киевская обл': 'Киевская область',
  'винницкая обл': 'Винницкая область',
  'волынская обл': 'Волынская область',
  'днепропетровская обл': 'Днепропетровская область',
  'донецкая обл': 'Донецкая Народная Республика', // Для унификации с текущей схемой
  'житомирская обл': 'Житомирская область',
  'закарпатская обл': 'Закарпатская область',
  // 'запорожская обл' удалена, т.к. уже определена выше
  'ивано-франковская обл': 'Ивано-Франковская область',
  'кировоградская обл': 'Кировоградская область',
  'луганская обл': 'Луганская Народная Республика', // Для унификации
  'львовская обл': 'Львовская область',
  'николаевская обл': 'Николаевская область',
  'одесская обл': 'Одесская область',
  'полтавская обл': 'Полтавская область',
  'ровненская обл': 'Ровненская область',
  'сумская обл': 'Сумская область',
  'тернопольская обл': 'Тернопольская область',
  'харьковская обл': 'Харьковская область',
  // 'херсонская обл' удалена, т.к. уже определена выше
  'хмельницкая обл': 'Хмельницкая область',
  'черкасская обл': 'Черкасская область',
  'черниговская обл': 'Черниговская область',
  'черновицкая обл': 'Черновицкая область',

  // Города Казахстана
  'павлодар': 'Республика Казахстан',
  'алматы': 'Республика Казахстан',
  'астана': 'Республика Казахстан',
  'караганда': 'Республика Казахстан',
  'актобе': 'Республика Казахстан',
  'шымкент': 'Республика Казахстан',
  'костанай': 'Республика Казахстан',
  'кокшетау': 'Республика Казахстан',
  'семей': 'Республика Казахстан',
  'талдыкорган': 'Республика Казахстан',
  'кызылорда': 'Республика Казахстан',
  'петропавловск': 'Республика Казахстан',
  'атбасар': 'Республика Казахстан',
  'рудный': 'Республика Казахстан',
  'жезказган': 'Республика Казахстан',

  // Кыргызстан
  'киргизия': 'Кыргызская Республика',
  'кыргызстан': 'Кыргызская Республика',
  'кыргызская республика': 'Кыргызская Республика',
  'бишкек': 'Кыргызская Республика',
  'ош': 'Кыргызская Республика',
  'джалал-абад': 'Кыргызская Республика',
  'джалалабад': 'Кыргызская Республика',
  'кара-балта': 'Кыргызская Республика',
  'карабалта': 'Кыргызская Республика',
  'токмак': 'Кыргызская Республика',
  'каракол': 'Кыргызская Республика',
  'балыкчы': 'Кыргызская Республика',
  'иссык-куль': 'Кыргызская Республика',
  'талас': 'Кыргызская Республика',
  'баткен': 'Кыргызская Республика',
  'чуйская обл': 'Кыргызская Республика',
  'ошская обл': 'Кыргызская Республика',
  'баткенская обл': 'Кыргызская Республика',
  'иссык-кульская обл': 'Кыргызская Республика',
  'нарынская обл': 'Кыргызская Республика',
  'таласская обл': 'Кыргызская Республика',

  // Армения
  'армения': 'Армения',
  'ереван': 'Армения',
  'гюмри': 'Армения',
  'ванадзор': 'Армения',
  'вагаршапат': 'Армения',
  'абовян': 'Армения',
  'капан': 'Армения',
  'араратская обл': 'Армения',
  'ардвирская обл': 'Армения',
  'ширакская обл': 'Армения',
  'сюникская обл': 'Армения',

  // Грузия
  'грузия': 'Грузия',
  'тбилиси': 'Грузия',
  'батуми': 'Грузия',
  'кутаиси': 'Грузия',
  'рустави': 'Грузия',
  'гори': 'Грузия',
  'зугдиди': 'Грузия',
  'поти': 'Грузия',
  'имеретия': 'Грузия',
  'аджария': 'Грузия',

  // Азербайджан
  'азербайджан': 'Азербайджан',
  'баку': 'Азербайджан',
  'гянджа': 'Азербайджан',
  'ганджа': 'Азербайджан',
  'сумгаит': 'Азербайджан',
  'мингячевир': 'Азербайджан',
  'нахичевань': 'Азербайджан',
  'апшеронский район': 'Азербайджан',

  // Молдова
  'молдавия': 'Республика Молдова', 'молдова': 'Республика Молдова',
  'кишинёв': 'Республика Молдова',
  'кишинев': 'Республика Молдова',
  'кишине́в': 'Республика Молдова',
  'бельцы': 'Республика Молдова',
  'оргеевский район': 'Республика Молдова',

  // Узбекистан
  'узбекистан': 'Республика Узбекистан',
  'ташкент': 'Республика Узбекистан',
  'самарканд': 'Республика Узбекистан',
  'бухара': 'Республика Узбекистан',
  'нукус': 'Республика Узбекистан',
  'андижан': 'Республика Узбекистан',
  'наманган': 'Республика Узбекистан',
  'фергана': 'Республика Узбекистан',
  'ташкентская обл': 'Республика Узбекистан',
  'самаркандская обл': 'Республика Узбекистан',
  'бухарская обл': 'Республика Узбекистан',
  'ферганская обл': 'Республика Узбекистан',
  
  // Таджикистан
  'таджикистан': 'Республика Таджикистан',
  'душанбе': 'Республика Таджикистан',
  'ходжент': 'Республика Таджикистан',
  'куляб': 'Республика Таджикистан',
  'согдийская обл': 'Республика Таджикистан',

  // Туркменистан
  'туркменистан': 'Туркменистан', 'туркмения': 'Туркменистан',
  'ашхабад': 'Туркменистан',
  'туркменабад': 'Туркменистан',
  'дашогуз': 'Туркменистан',
  'мары': 'Туркменистан',

  // Города, которые могут быть неоднозначны, но в контексте часто означают регион
  'москва': 'Москва',
  'санкт-петербург': 'Санкт-Петербург',
  'севастополь': 'Севастополь',
};

/**
 * Standardizes a region name to a consistent format.
 * Ensures the final output is clean, capitalized, and matches the official name.
 * @param input The detected region string.
 * @returns A standardized region name or the default "Регион не определен".
 */
export const standardizeRegion = (input: string | null | undefined): string => {
    if (!input) return 'Регион не определен';
    
    const cleanInput = input.trim();
    
    // The maps already contain the standardized names. This function primarily acts as a final formatter.
    const allStandardValues = new Set(Object.values(REGION_KEYWORD_MAP));
    if (allStandardValues.has(cleanInput)) {
        return cleanInput;
    }

    // Capitalize and return as a last resort
    return capitalize(cleanInput);
};
