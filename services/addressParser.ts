// services/addressParser.ts
import { regionCenters, normalizeRegion } from '../utils/addressMappings';
import { ParsedAddress } from '../types';

/* -------------------------------------------------------------
   1. Полный словарь fallback‑ключей
   ------------------------------------------------------------- */
const extendedRegionCenters: Record<string, string> = {
  ...regionCenters,  // Твой базовый (центры) — не трогай!

  // ──────────────────────────────────────────────────────────────
  // **РЕСПУБЛИКИ** (24 шт.)
  // ──────────────────────────────────────────────────────────────
  // Республика Адыгея
  "майкоп": "Республика Адыгея",
  "теучеж": "Республика Адыгея",
  "красногвардейское": "Республика Адыгея",
  "энем": "Республика Адыгея",
  "трехстропье": "Республика Адыгея",
  "гиагинская": "Республика Адыгея",
  "коджеско": "Республика Адыгея",
  "тхабсим": "Республика Адыгея",
  "пшихач": "Республика Адыгея",
  "кужорская": "Республика Адыгея",

  // Республика Алтай
  "горно-алтайск": "Республика Алтай",
  "майма": "Республика Алтай",
  "чомыш": "Республика Алтай",
  "солонешное": "Республика Алтай",
  "кызыл-мазал": "Республика Алтай",
  "катуар": "Республика Алтай",
  "иогач": "Республика Алтай",
  "кокса": "Республика Алтай",
  "туекта": "Республика Алтай",

  // Республика Башкортостан
  "уфа": "Республика Башкортостан",
  "стерлитамак": "Республика Башкортостан",
  "салават": "Республика Башкортостан",
  "нефтекамск": "Республика Башкортостан",
  "белорецк": "Республика Башкортостан",
  "сибай": "Республика Башкортостан",
  "туймазы": "Республика Башкортостан",
  "кумертау": "Республика Башкортостан",
  "мега": "Республика Башкортостан",
  "октябрьский": "Республика Башкортостан",

  // Республика Бурятия
  "улан-удэ": "Республика Бурятия",
  "северобайкальск": "Республика Бурятия",
  "гусиноозерск": "Республика Бурятия",
  "severobaikalsk": "Республика Бурятия",
  "кижингу": "Республика Бурятия",
  "забайкальск": "Республика Бурятия",
  "борзя": "Республика Бурятия",
  "мухоршибирь": "Республика Бурятия",
  "таксимо": "Республика Бурятия",

  // Республика Дагестан
  "махачкала": "Республика Дагестан",
  "дербент": "Республика Дагестан",
  "каспийск": "Республика Дагестан",
  "хасавюрт": "Республика Дагестан",
  "южно-сулакский": "Республика Дагестан",
  "южно-сулак": "Республика Дагестан",
  "дагестанские огни": "Республика Дагестан",
  "избербаш": "Республика Дагестан",
  "хасавюртовский": "Республика Дагестан",
  "кизиляюрт": "Республика Дагестан",

  // Республика Ингушетия
  "магас": "Республика Ингушетия",
  "назрань": "Республика Ингушетия",
  "малгобек": "Республика Ингушетия",
  "карла-маркса": "Республика Ингушетия",
  "моздок": "Республика Ингушетия",
  "малгобекский": "Республика Ингушетия",
  "назрановский": "Республика Ингушетия",
  "сунженский": "Республика Ингушетия",
  "джейрахский": "Республика Ингушетия",

  // Кабардино-Балкарская Республика
  "нальчик": "Кабардино-Балкарская Республика",
  "прохладный": "Кабардино-Балкарская Республика",
  "майский": "Кабардино-Балкарская Республика",
  "тырныауз": "Кабардино-Балкарская Республика",
  "баксан": "Кабардино-Балкарская Республика",
  "малка": "Кабардино-Балкарская Республика",
  "терск": "Кабардино-Балкарская Республика",
  "урванский": "Кабардино-Балкарская Республика",
  "захальдинский": "Кабардино-Балкарская Республика",
  "чегемский": "Кабардино-Балкарская Республика",

  // Республика Калмыкия
  "элиста": "Республика Калмыкия",
  "городовиковск": "Республика Калмыкия",
  "ларино": "Республика Калмыкия",
  "яган": "Республика Калмыкия",
  "уста-хуру": "Республика Калмыкия",
  "ики-бурул": "Республика Калмыкия",
  "чернь": "Республика Калмыкия",
  "пантелеймон": "Республика Калмыкия",
  "приютное": "Республика Калмыкия",
  "ягорлык": "Республика Калмыкия",

  // Карачаево-Черкесская Республика
  "черкесск": "Карачаево-Черкесская Республика",
  "усть-джегута": "Карачаево-Черкесская Республика",
  "к Aram": "Карачаево-Черкесская Республика",
  "микоян": "Карачаево-Черкесская Республика",
  "зеленчукская": "Карачаево-Черкесская Республика",
  "хумара": "Карачаево-Черкесская Республика",
  "инж": "Карачаево-Черкесская Республика",
  "родники": "Карачаево-Черкесская Республика",

  // Республика Карелия
  "петрозаводск": "Республика Карелия",
  "кемь": "Республика Карелия",
  "кондопога": "Республика Карелия",
  "сегежа": "Республика Карелия",
  "суоярви": "Республика Карелия",
  "сорск": "Республика Карелия",
  "питкяранта": "Республика Карелия",
  "олонец": "Республика Карелия",
  "лада": "Республика Карелия",
  "пудож": "Республика Карелия",

  // Республика Коми
  "сыктывкар": "Республика Коми",
  "инта": "Республика Коми",
  "воркута": "Республика Коми",
  "усинск": "Республика Коми",
  "пекра": "Республика Коми",
  "микунь": "Республика Коми",
  "сосногорск": "Республика Коми",
  "укта": "Республика Коми",
  "емва": "Республика Коми",
  "кослан": "Республика Коми",

  // Республика Крым
  "керачь": "Республика Крым",
  "феодосия": "Республика Крым",
  "ялта": "Республика Крым",
  "евпатория": "Республика Крым",
  "судак": "Республика Крым",
  "алушта": "Республика Крым",
  "бахчисарай": "Республика Крым",

  // Республика Марий Эл
  "йошкар-ола": "Республика Марий Эл",
  "волжск": "Республика Марий Эл",
  "зеленый город": "Республика Марий Эл",
  "медведево": "Республика Марий Эл",
  "морки": "Республика Марий Эл",
  "куженер": "Республика Марий Эл",
  "пайгарма": "Республика Марий Эл",
  "кизнер": "Республика Марий Эл",
  "советский": "Республика Марий Эл",
  "марий эл": "Республика Марий Эл",

  // Республика Мордовия
  "саранск": "Республика Мордовия",
  "рузаевка": "Республика Мордовия",
  "ковылкино": "Республика Мордовия",
  "инсар": "Республика Мордовия",
  "арадат": "Республика Мордовия",
  "хамаска": "Республика Мордовия",
  "ромоданово": "Республика Мордовия",
  "чами": "Республика Мордовия",
  "мордовия": "Республика Мордовия",

  // Республика Саха (Якутия)
  "якутск": "Республика Саха (Якутия)",
  "нерегу": "Республика Саха (Якутия)",
  "мирный": "Республика Саха (Якутия)",
  "покровск": "Республика Саха (Якутия)",
  "алданы": "Республика Саха (Якутия)",
  "нерюнгри": "Республика Саха (Якутия)",
  "хани": "Республика Саха (Якутия)",
  "дебины": "Республика Саха (Якутия)",
  "сунтар": "Республика Саха (Якутия)",
  "верхоянск": "Республика Саха (Якутия)",

  // Северная Осетия — Алания
  "дигора": "Республика Северная Осетия — Алания",
  "ардон": "Республика Северная Осетия — Алания",
  "беса": "Республика Северная Осетия — Алания",
  "кирово": "Республика Северная Осетия — Алания",
  "алджир": "Республика Северная Осетия — Алания",
  "гизель": "Республика Северная Осетия — Алания",
  "пригородный": "Республика Северная Осетия — Алания",
  "кимо": "Республика Северная Осетия — Алания",

  // Республика Татарстан
  "казань": "Республика Татарстан",
  "назеля": "Республика Татарстан",
  "альметьевск": "Республика Татарстан",
  "набережные-челны": "Республика Татарстан",
  "нижнекамск": "Республика Татарстан",
  "еленовка": "Республика Татарстан",
  "заинск": "Республика Татарстан",
  "чистополь": "Республика Татарстан",
  "нурлат": "Республика Татарстан",
  "арск": "Республика Татарстан",

  // Республика Тыва
  "кызыл": "Республика Тыва",
  "ак-довурок": "Республика Тыва",
  "тоожу": "Республика Тыва",
  "сарыг-сеп": "Республика Тыва",
  "кай": "Республика Тыва",
  "тээли": "Республика Тыва",
  "чадаан": "Республика Тыва",
  "чурга": "Республика Тыва",
  "самагалтай": "Республика Тыва",
  "тоя": "Республика Тыва",

  // Удмуртская Республика
  "ижевск": "Удмуртская Республика",
  "сарапул": "Удмуртская Республика",
  "мокси": "Удмуртская Республика",
  "гольяны": "Удмуртская Республика",
  "кез": "Удмуртская Республика",
  "григорьевка": "Удмуртская Республика",
  "ишим": "Удмуртская Республика",
  "дебёсы": "Удмуртская Республика",
  "каракулино": "Удмуртская Республика",
  "кильмезь": "Удмуртская Республика",

  // Республика Хакасия
  "абакан": "Республика Хакасия",
  "черногорск": "Республика Хакасия",
  "саяногорск": "Республика Хакасия",
  "сосновоборск": "Республика Хакасия",
  "минусино": "Республика Хакасия",
  "абаза": "Республика Хакасия",
  "таштагол": "Республика Хакасия",
  "уст-абакан": "Республика Хакасия",
  "бея": "Республика Хакасия",
  "альберт": "Республика Хакасия",

  // Чеченская Республика
  "грозный": "Чеченская Республика",
  "гудаур": "Чеченская Республика",
  "ургуб": "Чеченская Республика",
  "шали": "Чеченская Республика",
  "ургус-стан": "Чеченская Республика",
  "аргун": "Чеченская Республика",
  "гудермес": "Чеченская Республика",
  "урус-мартан": "Чеченская Республика",
  "кезенойам": "Чеченская Республика",
  "центорой": "Чеченская Республика",

  // Чувашская Республика
  "чебоксары": "Чувашская Республика",
  "новочебоксарск": "Чувашская Республика",
  "цивиля": "Чувашская Республика",
  "алатырь": "Чувашская Республика",
  "шумерля": "Чувашская Республика",
  "юман": "Чувашская Республика",
  "канадей": "Чувашская Республика",
  "клетия": "Чувашская Республика",
  "яльчик": "Чувашская Республика",
  "цивильск": "Чувашская Республика",

  // ──────────────────────────────────────────────────────────────
  // **КРАЯ** (9 шт.)
  // ──────────────────────────────────────────────────────────────
  // Алтайский край
  "барнаул": "Алтайский край",
  "бийск": "Алтайский край",
  "рубцовск": "Алтайский край",
  "новоалтайск": "Алтайский край",
  "змеиногорск": "Алтайский край",
  "алтайское": "Алтайский край",
  "благовещенка": "Алтайский край",
  "александровка": "Алтайский край",
  "косиха": "Алтайский край",

  // Забайкальский край
  "чите": "Забайкальский край",
  "краснокаменск": "Забайкальский край",
  "балей": "Забайкальский край",
  "петровск- Забайкальский": "Забайкальский край",
  "могоча": "Забайкальский край",
  "чернышевск": "Забайкальский край",
  "карымское": "Забайкальский край",
  "кыра": "Забайкальский край",
  // "нельми": "Забайкальский край", // Likely duplicate

  // Камчатский край
  "петропавловск-камчатский": "Камчатский край",
  "вилючинск": "Камчатский край",
  "елизово": "Камчатский край",
  "паратунка": "Камчатский край",
  "мильково": "Камчатский край",
  "палана": "Камчатский край",
  "усть-камчатск": "Камчатский край",
  "тигиль": "Камчатский край",
  "коряки": "Камчатский край",
  "быстринский": "Камчатский край",

  // Краснодарский край
  "краснодар": "Краснодарский край",
  "армавир": "Краснодарский край",
  "новороссийск": "Краснодарский край",
  "туапсе": "Краснодарский край",
  "славянск-на-кубани": "Краснодарский край",

  // Красноярский край
  "красноярск": "Красноярский край",
  "норильск": "Красноярский край",
  "ачинск": "Красноярский край",
  "кандалакша": "Красноярский край",
  "лесосибирск": "Красноярский край",
  "забаикальск": "Красноярский край",

  // Пермский край
  "пермь": "Пермский край",
  "березники": "Пермский край",
  "соликамск": "Пермский край",
  "лысьва": "Пермский край",
  "кизел": "Пермский край",
  "чусовой": "Пермский край",
  "кос": "Пермский край",
  "добрянка": "Пермский край",
  "губаха": "Пермский край",

  // Приморский край
  "владивосток": "Приморский край",
  "у ss ур ийск": "Приморский край",
  "нах одка": "Приморский край",
  "артем": "Приморский край",
  "лау тов": "Приморский край",
  "спасск-дальний": "Приморский край",
  "дальнереченск": "Приморский край",
  "покровское": "Приморский край",
  "лучегорск": "Приморский край",
  "фокино": "Приморский край",

  // Ставропольский край
  "ставрополь": "Ставропольский край",
  "минеральные-воды": "Ставропольский край",
  "кисловодск": "Ставропольский край",
  "невинномысск": "Ставропольский край",
  "буденновск": "Ставропольский край",
  "ессентуки": "Ставропольский край",
  "г еоргиевск": "Ставропольский край",
  "изобильный": "Ставропольский край",
  "светлоград": "Ставропольский край",

  // Хабаровский край
  "хабаровск": "Хабаровский край",
  "комсомольск-на-амуре": "Хабаровский край",
  "юности": "Хабаровский край",
  "хабаровский": "Хабаровский край",
  "амурск": "Хабаровский край",
  "николаевск-на-амуре": "Хабаровский край",
  "ванино": "Хабаровский край",
  "советская-Гавань": "Хабаровский край",
  "хурмули": "Хабаровский край",

  // ──────────────────────────────────────────────────────────────
  // **ОБЛАСТИ** (48 шт.)
  // ──────────────────────────────────────────────────────────────
  // Амурская область
  "благовещенск": "Амурская область",
  "свободный": "Амурская область",
  "белогорск": "Амурская область",
  "райчихинск": "Амурская область",
  "прогресс": "Амурская область",
  "зея": "Амурская область",
  "тында": "Амурская область",
  "уркана": "Амурская область",
  "серышево": "Амурская область",
  "сковородино": "Амурская область",

  // Архангельская область
  "архангельск": "Архангельская область",
  "северодвинск": "Архангельская область",
  "котлас": "Архангельская область",
  "коряжма": "Архангельская область",
  "новодвинск": "Архангельская область",
  "наръян-мар": "Архангельская область",
  "карпогоры": "Архангельская область",
  "моржовец": "Архангельская область",
  "пинег": "Архангельская область",
  "мезень": "Архангельская область",

  // Астраханская область
  "астрахань": "Астраханская область",
  "знаменск": "Астраханская область",
  "ахтубинск": "Астраханская область",
  "харабалин": "Астраханская область",
  "нариманов": "Астраханская область",
  "ипатово": "Астраханская область",
  "володарский": "Астраханская область",
  "карамышка": "Астраханская область",
  "чернышков": "Астраханская область",
  "хаджи-мurat": "Астраханская область",

  // Белгородская область
  "белгород": "Белгородская область",
  "старый-ос кол": "Белгородская область",
  "губкин": "Белгородская область",
  "шевенг": "Белгородская область",
  "старово": "Белгородская область",
  "алексеевка": "Белгородская область",
  "валуйки": "Белгородская область",
  "степан": "Белгородская область",
  "разумное": "Белгородская область",
  "томаровка": "Белгородская область",

  // Брянская область
  "брянск": "Брянская область",
  "клинцы": "Брянская область",
  "новозыбков": "Брянская область",
  "унеча": "Брянская область",
  "кардым": "Брянская область",
  "сельцо": "Брянская область",
  "дыбово": "Брянская область",
  "покачи": "Брянская область",
  "мглин": "Брянская область",

  // Владимирская область
  "владимир": "Владимирская область",
  "ковров": "Владимирская область",
  "музров": "Владимирская область",
  "александров": "Владимирская область",
  "колу тов": "Владимирская область",
  "суздаль": "Владимирская область",
  "гусь-хрустальный": "Владимирская область",
  "покров": "Владимирская область",
  "собинка": "Владимирская область",
  "вязники": "Владимирская область",

  // Волгоградская область
  "волгоград": "Волгоградская область",
  "волжский": "Волгоградская область",
  "камышин": "Волгоградская область",
  "михайловка": "Волгоградская область",
  "урюпино": "Волгоградская область",
  "фролово": "Волгоградская область",
  "светлый-яр": "Волгоградская область",
  "котов": "Волгоградская область",
  "николаевск": "Волгоградская область",
  "иловля": "Волгоградская область",

  // Вологодская область
  "вологда": "Волгоградская область",
  "череповец": "Вологодская область",
  "сокол": "Вологодская область",
  "тотьма": "Вологодская область",
  "великий-устюг": "Вологодская область",
  "кадый": "Вологодская область",
  "грахово": "Вологодская область",
  "харовск": "Вологодская область",
  "вытегра": "Вологодская область",

  // Воронежская область
  "воронеж": "Воронежская область",
  "липецк": "Воронежская область",
  "борисоглебск": "Воронежская область",
  "ус ман": "Воронежская область",
  "калач": "Воронежская область",
  "нововоронеж": "Воронежская область",
  "семилуки": "Воронежская область",
  "эр tilting": "Воронежская область",
  "павловск": "Воронежская область",
  "но вохопёрск": "Воронежская область",

  // Ивановская область
  "иваново": "Ивановская область",
  "кингисепп": "Ивановская область",
  "шую": "Ивановская область",
  "теаковский": "Ивановская область",
  "фурманов": "Ивановская область",
  "приволжск": "Ивановская область",
  "пучеж": "Ивановская область",
  "ильин": "Ивановская область",
  "комсомольск": "Ивановская область",
  "южа": "Ивановская область",

  // Иркутская область
  "иркутск": "Иркутская область",
  "братск": "Иркутская область",
  "ангарск": "Иркутская область",
  "уст-и лимск": "Иркутская область",
  "черемхово": "Иркутская область",
  "шелехов": "Иркутская область",
  "саянск": "Иркутская область",
  "залари": "Иркутская область",
  "усолье-сибирское": "Иркутская область",
  "тулу н": "Иркутская область",

  // Калининградская область
  "советск": "Калининградская область",
  "багратионовск": "Калининградская область",
  "гурьевск": "Калининградская область",
  "пинск": "Калининградская область",
  "неман": "Калининградская область",
  "мамоново": "Калининградская область",
  "гвардейск": "Калининградская область",
  "светлогорск": "Калининградская область",

  // Калужская область
  "калуга": "Калужская область",
  "обнинск": "Калужская область",
  "малоярославец": "Калужская область",
  "бала баново": "Калужская область",
  "борисов": "Калужская область",
  "кондрово": "Калужская область",
  "козельск": "Калужская область",
  "людино": "Калужская область",

  // Кемеровская область — Кузбасс
  "кемерово": "Кемеровская область — Кузбасс",
  "новокузнецк": "Кемеровская область — Кузбасс",
  "прокопьевск": "Кемеровская область — Кузбасс",
  "междуреченск": "Кемеровская область — Кузбасс",
  "белово": "Кемеровская область — Кузбасс",
  "берёзовский": "Кемеровская область — Кузбасс",
  "юргинский": "Кемеровская область — Кузбасс",
  "кемеровская": "Кемеровская область — Кузбасс",
  "анжеро-судженск": "Кемеровская область — Кузбасс",

  // Кировская область
  "киров": "Кировская область",
  "кирово-чепецк": "Кировская область",
  "слободской": "Кировская область",
  "вятские- полян": "Кировская область",
  "орлов": "Кировская область",
  "котельнич": "Кировская область",
  "луза": "Кировская область",
  "степан ида": "Кировская область",
  "малюга": "Кировская область",
  "мурыгино": "Кировская область",

  // Костромская область
  "кострома": "Костромская область",
  "галич": "Костромская область",
  "шарья": "Костромская область",
  "нерехта": "Костромская область",
  "буй": "Костромская область",
  "волго-дре": "Костромская область",
  "островское": "Костромская область",
  "макарьев": "Костромская область",
  "поназырево": "Костромская область",
  "кологрив": "Костромская область",

  // Курганская область
  "курган": "Курганская область",
  "петухово": "Курганская область",
  "микрон": "Курганская область",
  "шадринск": "Курганская область",
  "далматово": "Курганская область",
  "катайск": "Курганская область",
  // "михайлов": "Курганская область", // Likely duplicate
  "варгаши": "Курганская область",

  // Курская область
  "курск": "Курская область",
  "железногорск": "Курская область",
  "курчатов": "Курская область",
  "льгов": "Курская область",
  "фатеж": "Курская область",
  "щукино": "Курская область",
  "тим": "Курская область",
  "обоянь": "Курская область",
  "касторная": "Курская область",
  "рыльск": "Курская область",

  // Ленинградская область
  "гатчина": "Ленинградская область",
  "всеволожск": "Ленинградская область",
  "кириши": "Ленинградская область",
  "ивангород": "Ленинградская область",
  "кировск": "Ленинградская область",
  "лодейное-поле": "Ленинградская область",
  "луга": "Ленинградская область",
  "приозерск": "Ленинградская область",
  "сланцы": "Ленинградская область",

  // Липецкая область
  "елец": "Липецкая область",
  "данков": "Липецкая область",
  "доброе": "Липецкая область",
  "долгоруково": "Липецкая область",
  "избердеев": "Липецкая область",
  "лебедянь": "Липецкая область",
  "усмань": "Липецкая область",
  "хлевище": "Липецкая область",
  "грязи": "Липецкая область",

  // Магаданская область
  "мага дан": "Магаданская область",
  "палатка": "Магаданская область",
  "ольский": "Магаданская область",
  "сусуман": "Магаданская область",
  "ягодное": "Магаданская область",
  "омсукчан": "Магаданская область",
  "дук ат": "Магаданская область",
  "оле км а": "Магаданская область",
  "хасын": "Магаданская область",
  "долинск": "Магаданская область",

  // Московская область
  "подольск": "Московская область",
  "химки": "Московская область",
  "одинцово": "Московская область",
  "митино": "Московская область",
  "лыткарино": "Московская область",
  "фрязино": "Московская область",
  "королёв": "Московская область",
  "пушкино": "Московская область",
  "долгопрудный": "Московская область",

  // Мурманская область
  "му рманск": "Мурманская область",
  "апатиты": "Мурманская область",
  "оловянная": "Мурманская область",
  "западная-лица": "Мурманская область",
  "полярный": "Мурманская область",
  "мурманск": "Мурманская область",
  "никель": "Мурманская область",
  "полярные-зори": "Мурманская область",

  // Нижегородская область
  "нижний-новгород": "Нижегородская область",
  "дзержинск": "Нижегородская область",
  "арзамас": "Нижегородская область",
  "выкса": "Нижегородская область",
  "канавин": "Нижегородская область",
  "бор": "Нижегородская область",
  "кулебак и": "Нижегородская область",
  "семёнов": "Нижегородская область",
  "саров": "Нижегородская область",
  "шахунья": "Нижегородская область",

  // Новгородская область
  "великий-новгород": "Новгородская область",
  "боровичи": "Новгородская область",
  "чудово": "Новгородская область",
  "малая-вишера": "Новгородская область",
  "валдай": "Новгородская область",
  "демянск": "Новгородская область",
  "старая-русса": "Новгородская область",
  "сольцы": "Новгородская область",
  "пестово": "Новгородская область",
  "хвойная": "Новгородская область",

  // Новосибирская область
  "новосибирск": "Новосибирская область",
  "бердск": "Новосибирская область",
  "искитим": "Новосибирская область",
  "обь": "Новосибирская область",
  "новосибирская": "Новосибирская область",
  "колцово": "Новосибирская область",
  "краснообск": "Новосибирская область",
  "кру т я": "Новосибирская область",
  "болотово": "Новосибирская область",

  // Омская область
  "омск": "Омская область",
  "тара": "Омская область",
  "исилькуль": "Омская область",
  "тименское": "Омская область",
  "черлак": "Омская область",
  "таврическое": "Омская область",
  "марьяновка": "Омская область",
  "любинский": "Омская область",
  "троснянка": "Омская область",
  "одесское": "Омская область",

  // Оренбургская область
  "оренбург": "Оренбургская область",
  "орск": "Оренбургская область",
  "медная": "Оренбургская область",
  "га тч ина": "Оренбургская область",
  "бугуруслан": "Оренбургская область",
  "саракташ": "Оренбургская область",
  "макушкино": "Оренбургская область",
  "сол игалич": "Оренбургская область",
  "переволоцкий": "Оренбургская область",

  // Орловская область
  "орёл": "Орловская область",
  "мценск": "Орловская область",
  "болхов": "Орловская область",
  "дросково": "Орловская область",
  "знобово": "Орловская область",
  "хотынец": "Орловская область",
  "должанская": "Орловская область",
  "колпны": "Орловская область",
  "свердловск": "Орловская область",

  // Пензенская область
  "пенз а": "Пензенская область",
  "заречный": "Пензенская область",
  "кунгуры": "Пензенская область",
  "городище": "Пензенская область",
  "никольск": "Пензенская область",
  "сердобск": "Пензенская область",
  "кунгур": "Пензенская область",
  "мокшан": "Пензенская область",
  "соседка": "Пензенская область",
  "белинская": "Пензенская область",

  // Псковская область
  "псков": "Псковская область",
  "великие-луки": "Псковская область",
  "остров": "Псковская область",
  "невель": "Псковская область",
  "печоры": "Псковская область",
  "порхов": "Псковская область",
  "редки": "Псковская область",
  "гдов": "Псковская область",
  "струги-красные": "Псковская область",

  // Ростовская область
  "ростов-на-дону": "Ростовская область",
  "таганрог": "Ростовская область",
  "шахты": "Ростовская область",
  "новочеркасск": "Ростовская область",
  "волгодонск": "Ростовская область",
  "батайск": "Ростовская область",
  "азов": "Ростовская область",
  "сальск": "Ростовская область",
  "гремячий": "Ростовская область",
  "семикаракорск": "Ростовская область",

  // Рязанская область
  "рязань": "Рязанская область",
  "кашира": "Рязанская область",
  "касимов": "Рязанская область",
  "рязанская": "Рязанская область",
  "спасск-рязанский": "Рязанская область",
  "михайлов": "Рязанская область",
  "скопин": "Рязанская область",
  "новомичуринск": "Рязанская область",
  "рыбное": "Рязанская область",

  // Самарская область
  "самара": "Самарская область",
  "тольятти": "Самарская область",
  "сызрань": "Самарская область",
  "новокуйбышевск": "Самарская область",
  "чапаевск": "Самарская область",
  "сургут": "Самарская область",
  "хвалынск": "Самарская область",
  "сергиевск": "Самарская область",
  "подстепки": "Самарская область",

  // Саратовская область
  "саратов": "Саратовская область",
  "энгельс": "Саратовская область",
  "балаково": "Саратовская область",
  "балашов": "Саратовская область",
  "маркс": "Саратовская область",
  "светлый": "Саратовская область",
  "ершов": "Саратовская область",
  "круглянка": "Саратовская область",

  // Сахалинская область
  "южно-сахалинск": "Сахалинская область",
  "холмск": "Сахалинская область",
  "корсаков": "Сахалинская область",
  "порона иск": "Сахалинская область",
  "макаров": "Сахалинская область",
  "у глегород": "Сахалинская область",
  "томари": "Сахалинская область",
  "тихи н": "Сахалинская область",
  "южно-курильск": "Сахалинская область",

  // Свердловская область
  "екатеринбург": "Свердловская область",
  "нижний-тагил": "Свердловская область",
  "каменск-уральский": "Свердловская область",
  "первоуральск": "Свердловская область",
  "североуральск": "Свердловская область",
  "новоуральск": "Свердловская область",
  "невьянск": "Свердловская область",
  "полевской": "Свердловская область",
  "ревда": "Свердловская область",

  // Смоленская область
  "смоленск": "Смоленская область",
  "вязьма": "Смоленская область",
  "сафоново": "Смоленская область",
  "десногорск": "Смоленская область",
  "гагарин": "Смоленская область",
  "рославль": "Смоленская область",
  "яpцево": "Смоленская область",
  "демидов": "Смоленская область",
  "починок": "Смоленская область",
  "духовщина": "Смоленская область",

  // Тамбовская область
  "тамбов": "Тамбовская область",
  "моршанск": "Тамбовская область",
  "рассказово": "Тамбовская область",
  "котовск": "Тамбовская область",
  "у варово": "Тамбовская область",
  "жадов": "Тамбовская область",
  "мучкапский": "Тамбовская область",
  "токарёв": "Тамбовская область",
  "инжавино": "Тамбовская область",
  "перевоз": "Тамбовская область",

  // Тверская область
  "тверь": "Тверская область",
  "верхняя-масловка": "Тверская область",
  "весьегонск": "Тверская область",
  "зап.": "Тверская область",
  "калинин": "Тверская область",
  "кесова-гора": "Тверская область",
  "лин": "Тверская область",
  "максатиха": "Тверская область",
  "минусинск": "Тверская область",

  // Томская область
  "томск": "Томская область",
  "северск": "Томская область",
  "стрей": "Томская область",
  "асино": "Томская область",
  "кедровый": "Томская область",
  "колпашево": "Томская область",
  "александровск": "Томская область",
  "молчаново": "Томская область",
  "подгорное": "Томская область",

  // Тульская область
  "тула": "Тульская область",
  "новомосковск": "Тульская область",
  "узловая": "Тульская область",
  "щёкино": "Тульская область",
  "алексин": "Тульская область",
  "суворов": "Тульская область",
  "венёв": "Тульская область",
  "зубцов": "Тульская область",
  "эфремов": "Тульская область",

  // Тюменская область
  "тюмень": "Тюменская область",
  "боровск": "Тюменская область",
  "яровое": "Тюменская область",
  "заводоуковск": "Тюменская область",
  "голышманово": "Тюменская область",
  "арм изонский": "Тюменская область",
  "утяр": "Тюменская область",
  "исетское": "Тюменская область",
  "виктория": "Тюменская область",

  // Ульяновская область
  "ульяновск": "Ульяновская область",
  "димитровград": "Ульяновская область",
  "инза": "Ульяновская область",
  "сенгилей": "Ульяновская область",
  "новоульяновск": "Ульяновская область",
  "карсули": "Ульяновская область",
  "чердаклы": "Ульяновская область",
  "старая-кул атка": "Ульяновская область",
  "новоспасское": "Ульяновская область",
  "майна": "Ульяновская область",

  // Челябинская область
  "челябинск": "Челябинская область",
  "магнитогорск": "Челябинская область",
  "златоуст": "Челябинская область",
  "миасс": "Челябинская область",
  "кыштым": "Челябинская область",
  "верхний-уфалей": "Челябинская область",
  "три стру": "Челябинская область",
  "снежинск": "Челябинская область",
  "катав- ивановск": "Челябинская область",
  "кopeск": "Челябинская область",

  // Ярославская область
  "ярославль": "Ярославская область",
  "рыбинск": "Ярославская область",
  "у глич": "Ярославская область",
  "переславль- залесский": "Ярославская область",
  "му рома": "Ярославская область",
  "ростов": "Ярославская область",
  "тутаев": "Ярославская область",
  "га лич": "Ярославская область",
  "данилов": "Ярославская область",
  "нея": "Ярославская область",

  // ──────────────────────────────────────────────────────────────
  // **ГОРОДА ФЕДЕРАЛЬНОГО ЗНАЧЕНИЯ** (3 шт.)
  // ──────────────────────────────────────────────────────────────
  "севастополь": "Севастополь",

  // ──────────────────────────────────────────────────────────────
  // **АВТОНОМНАЯ ОБЛАСТЬ** (1 шт.)
  // ──────────────────────────────────────────────────────────────
  // Еврейская автономная область
  "биробиджан": "Еврейская автономная область",
  "ленск": "Еврейская автономная область",
  "облучье": "Еврейская автономная область",
  "известия": "Еврейская автономная область",
  "ленг о": "Еврейская автономная область",
  "нижне-леньго": "Еврейская автономная область",
  "поярков": "Еврейская автономная область",
  "иде": "Еврейская автономная область",
  "воскресеновка": "Еврейская автономная область",
  "имени-тельмана": "Еврейская автономная область",

  // ──────────────────────────────────────────────────────────────
  // **АВТОНОМНЫЕ ОКРУГА** (4 шт.)
  // ──────────────────────────────────────────────────────────────
  // Ненецкий автономный округ
  "наръян-мар": "Ненецкий автономный округ",
  "амдерма": "Ненецкий автономный округ",
  "варандей": "Ненецкий автономный округ",
  "индига": "Ненецкий автономный округ",
  "бу оянга": "Ненецкий автономный округ",
  "харьяга": "Ненецкий автономный округ",
  "исаково": "Ненецкий автономный округ",
  "нельми": "Ненецкий автономный округ",
  "оксино": "Ненецкий автономный округ",
  "каратайка": "Ненецкий автономный округ",

  // Ханты-Мансийский автономный округ — Югра
  "ханты-мансийск": "Ханты-Мансийский автономный округ — Югра",
  "нижневартовск": "Ханты-Мансийский автономный округ — Югра",
  "нефтеюганск": "Ханты-Мансийский автономный округ — Югра",
  "когалым": "Ханты-Мансийский автономный округ — Югра",
  "мегион": "Ханты-Мансийский автономный округ — Югра",
  "нижне-сортим": "Ханты-Мансийский автономный округ — Югра",
  "радев": "Ханты-Мансийский автономный округ — Югра",
  "лукьянки": "Ханты-Мансийский автономный округ — Югра",

  // Чукотский автономный округ
  "анадырь": "Чукотский автономный округ",
  "билибино": "Чукотский автономный округ",
  "певек": "Чукотский автономный округ",
  "провидения": "Чукотский автономный округ",
  "берлин": "Чукотский автономный округ",
  "уэлен": "Чукотский автономный округ",
  "лаврентия": "Чукотский автономный округ",
  "эмэн": "Чукотский автономный округ",
  "н physi": "Чукотский автономный округ",

  // Ямало-Ненецкий автономный округ
  "салехард": "Ямало-Ненецкий автономный округ",
  "новый-уренгой": "Ямало-Ненецкий автономный округ",
  "ноябрьск": "Ямало-Ненецкий автономный округ",
  "губкинский": "Ямало-Ненецкий автономный округ",
  "муравленко": "Ямало-Ненецкий автономный округ",
  "таза": "Ямало-Ненецкий автономный округ",
  "тарко-сале": "Ямало-Ненецкий автономный округ",
  "лапы": "Ямало-Ненецкий автономный округ",
  "панаевск": "Ямало-Ненецкий автономный округ",

  // ──────────────────────────────────────────────────────────────
  // **НОВЫЕ СУБЪЕКТЫ** (ДНР, ЛНР, Херсон, Запорожье)
  // ──────────────────────────────────────────────────────────────
  // Донецкая Народная Республика
  "донецк": "Донецкая Народная Республика",
  "гоpловка": "Донецкая Народная Республика",
  "мариуполь": "Донецкая Народная Республика",
  "макеевка": "Донецкая Народная Республика",
  "горловка": "Донецкая Народная Республика",
  "доброполье": "Донецкая Народная Республика",
  "бахмут": "Донецкая Народная Республика",
  "селидово": "Донецкая Народная Республика",
  "костянтиновка": "Донецкая Народная Республика",
  "артемовск": "Донецкая Народная Республика",

  // Луганская Народная Республика
  "луганск": "Луганская Народная Республика",
  "алчевск": "Луганская Народная Республика",
  "лисичанск": "Луганская Народная Республика",
  "северодонецк": "Луганская Народная Республика",
  "рубежное": "Луганская Народная Республика",
  "краснодон": "Луганская Народная Республика",
  "стаханов": "Луганская Народная Республика",
  "первомайск": "Луганская Народная Республика",
  "браховка": "Луганская Народная Республика",

  // Херсонская область
  "херсон": "Херсонская область",
  "геническ": "Херсонская область",
  "ск ад овск": "Херсонская область",
  "новотроицкое": "Херсонская область",
  "калининдорф": "Херсонская область",
  "голая-пристань": "Херсонская область",
  "цыпково": "Херсонская область",
  "берислав": "Херсонская область",
  "великая-александровка": "Херсонская область",
  "качаевка": "Херсонская область",

  // Запорожская область
  "мелитополь": "Запорожская область",
  "запорожье": "Запорожская область",
  "бердянск": "Запорожская область",
  "энергодар": "Запорожская область",
  "токмак": "Запорожская область",
  "пологи": "Запорожская область",
  "гуляйполе": "Запорожская область",
  "ор ихов": "Запорожская область",
  "васильевка": "Запорожская область",

  // ──────────────────────────────────────────────────────────────
  // **СНГ: СТРАНЫ** (10 основных + ассоциированные)
  // ──────────────────────────────────────────────────────────────
  // Азербайджанская Республика
  "баку": "Азербайджанская Республика",
  "гянджа": "Азербайджанская Республика",
  "сумгаит": "Азербайджанская Республика",
  "ленгеран": "Азербайджанская Республика",
  "мингечаур": "Азербайджанская Республика",
  "ширван": "Азербайджанская Республика",
  "евлах": "Азербайджанская Республика",
  "кюрдемир": "Азербайджанская Республика",
  "яким": "Азербайджанская Республика",

  // Республика Армения
  "ереван": "Республика Армения",
  "гюмри": "Республика Армения",
  "ваан": "Республика Армения",
  "абовян": "Республика Армения",
  // FIX: Commented out duplicate key 'армавир'. The more relevant one for Krasnodar Krai is kept.
  // "армавир": "Республика Армения",
  "арташат": "Республика Армения",
  "спитак": "Республика Армения",
  "талин": "Республика Армения",
  "маздра": "Республика Армения",

  // Республика Беларусь
  "минск": "Республика Беларусь",
  "гродно": "Республика Беларусь",
  "витебск": "Республика Беларусь",
  "могилёв": "Республика Беларусь",
  "брест": "Республика Беларусь",
  "гомель": "Республика Беларусь",
  "бобруйск": "Республика Беларусь",
  "барановичи": "Республика Беларусь",
  "полоцк": "Республика Беларусь",
  "орша": "Республика Беларусь",

  // Республика Казахстан
  "астана": "Республика Казахстан",
  "алматы": "Республика Казахстан",
  "шымкент": "Республика Казахстан",
  "караганда": "Республика Казахстан",
  "актау": "Республика Казахстан",
  "акмола": "Республика Казахстан",
  "темиртау": "Республика Казахстан",
  "уст-каменогорск": "Республика Казахстан",
  "павлодар": "Республика Казахстан",
  "семей": "Республика Казахстан",

  // Кыргызская Республика
  "бишкек": "Киргизская Республика",
  "ош": "Киргизская Республика",
  "джалал-абад": "Киргизская Республика",
  // FIX: Commented out duplicate key 'токмак'. The more relevant one for Zaporozhye is kept.
  // "токмак": "Киргизская Республика",
  "талас": "Киргизская Республика",
  "кара-балта": "Киргизская Республика",
  "кант": "Киргизская Республика",
  "орду": "Киргизская Республика",
  "балды": "Киргизская Республика",
  "нарын": "Киргизская Республика",

  // Республика Молдова
  "кишинёв": "Республика Молдова",
  // FIX: Commented out duplicate key 'тирасполь'. The more specific one for Transnistria is kept.
  // "тирасполь": "Республика Молдова",
  // FIX: Commented out duplicate key 'бендеры'. The more specific one for Transnistria is kept.
  // "бендеры": "Республика Молдова",
  // FIX: Commented out duplicate key 'рыбница'. The more specific one for Transnistria is kept.
  // "рыбница": "Республика Молдова",
  "унген": "Республика Молдова",
  "сори": "Республика Молдова",
  "бэлць": "Республика Молдова",
  "добруджа": "Республика Молдова",
  "комрат": "Республика Молдова",
  "единец": "Республика Молдова",

  // Республика Таджикистан
  "душанбе": "Республика Таджикистан",
  "худжанд": "Республика Таджикистан",
  "курган-теппа": "Республика Таджикистан",
  "куляб": "Республика Таджикистан",
  "исфара": "Республика Таджикистан",
  "пяндж": "Республика Таджикистан",
  "конгирад": "Республика Таджикистан",
  "истаравшан": "Республика Таджикистан",
  "гуisar": "Республика Таджикистан",
  "обигарм": "Республика Таджикистан",

  // Туркменистан (ассоциированный)
  "ашхабад": "Туркменистан",
  "туркменбаши": "Туркменистан",
  "туркменабад": "Туркменистан",
  "мары": "Туркменистан",
  "башкаала": "Туркменистан",
  "бейди": "Туркменистан",
  "дашховуз": "Туркменистан",
  "серхетабад": "Туркменистан",
  "эсенгулы": "Туркменистан",

  // Республика Узбекистан
  "ташкент": "Республика Узбекистан",
  "самарканд": "Республика Узбекистан",
  "бухара": "Республика Узбекистан",
  "андижан": "Республика Узбекистан",
  "нам анг ан": "Республика Узбекистан",
  "фарга на": "Республика Узбекистан",
  "карши": "Республика Узбекистан",
  "шахрисабз": "Республика Узбекистан",
  "ургенч": "Республика Узбекистан",
  "термез": "Республика Узбекистан",

  // ──────────────────────────────────────────────────────────────
  // **НЕПРИЗНАННЫЕ РЕСПУБЛИКИ И РЕГИОНЫ** (как Абхазия)
  // ──────────────────────────────────────────────────────────────
  // Республика Абхазия
  "сухум": "Республика Абхазия",
  "гагра": "Республика Абхазия",
  "гудаута": "Республика Абхазия",
  "галь": "Республика Абхазия",
  "пицунда": "Республика Абхазия",
  "гуп": "Республика Абхазия",
  "очамчира": "Республика Абхазия",
  "ткварчели": "Республика Абхазия",
  "новый-афон": "Республика Абхазия",
  "гечрипши": "Республика Абхазия",

  // Республика Южная Осетия
  "цхинвал": "Республика Южная Осетия",
  "знаур": "Республика Южная Осетия",
  "джава": "Республика Южная Осетия",
  "ленджи": "Республика Южная Осетия",
  "квайса": "Республика Южная Осетия",
  "тсхинвал": "Республика Южная Осетия",
  "кели": "Республика Южная Осетия",
  "корни": "Республика Южная Осетия",
  "тирали": "Республика Южная Осетия",
  "знаури": "Республика Южная Осетия",

  // Приднестровская Молдавская Республика
  "тирасполь": "Приднестровская Молдавская Республика",
  "бендеры": "Приднестровская Молдавская Республика",
  "рыбница": "Приднестровская Молдавская Республика",
  "слободзея": "Приднестровская Молдавская Республика",
  "кама": "Приднестровская Молдавская Республика",
  "днестровск": "Приднестровская Молдавская Республика",
  "парканы": "Приднестровская Молдавская Республика",
  // FIX: Commented out duplicate key 'первомайск'. The more relevant one for Luhansk is kept.
  // "первомайск": "Приднестровская Молдавская Республика",
  "доман": "Приднестровская Молдавская Республика",
  "мига": "Приднестровская Молдавская Республика",

  // Нагорно-Карабахская Республика (Арцах, статус спорный после 2023)
  "степанакерт": "Нагорно-Карабахская Республика",
  "шуша": "Нагорно-Карабахская Республика",
  "аскеран": "Нагорно-Карабахская Республика",
  "бердзо": "Нагорно-Карабахская Республика",
  "хачена": "Нагорно-Карабахская Республика",
  "марас": "Нагорно-Карабахская Республика",
  "гадрут": "Нагорно-Карабахская Республика",

  // Старые записи, которые были добавлены ранее (для сохранения)
    "симферопольский": "Республика Крым", 
    "саки": "Республика Крым", 
    "гвардейское": "Республика Крым", 
    // "красногвардейское": "Республика Крым", 
    "нижнегорский": "Республика Крым", 
    "кировское": "Республика Крым", 
    "ленино": "Республика Крым", 
    "раздольное": "Республика Крым", 
    "черноморское": "Республика Крым", 
    "джанкой": "Республика Крым", 
    "партенит": "Республика Крым", 
    "гурзуф": "Республика Крым", 
    "алупка": "Республика Крым", 
    "коктебель": "Республика Крым", 
    "вилина": "Республика Крым", 
    "зуя": "Республика Крым", 
    "кам енка": "Республика Крым", 
    "октябрьское": "Республика Крым", 
    "новофедоровка": "Республика Крым", 
    "уютное": "Республика Крым", 
    "заозёрное": "Республика Крым", 
    "белогорский": "Республика Крым", 
    "крымская роза": "Республика Крым",
    "гал": "Республика Абхазия", 
    // FIX: Commented out duplicate key to prevent compilation error. A valid definition exists earlier.
    // "очамчира": "Республика Абхазия", 
    "ткуарчал": "Республика Абхазия", 
    "новый афон": "Республика Абхазия", 
    "гечрипш": "Республика Абхазия", 
    "аауадхара": "Республика Абхазия",
    "гостагаевская": "Краснодарский край", 
    "тихо рецк": "Краснодарский край", 
    "тихорецк": "Краснодарский край", 
    "динская": "Краснодарский край", 
    "адлерский": "Краснодарский край", 
    "полтавская": "Краснодарский край", 
    "владимирская": "Краснодарский край", 
    "красноадр": "Краснодарский край", 
    "северская": "Краснодарский край", 
    "темрюк": "Краснодарский край", 
    "elizavetinskaya": "Краснодарский край", 
    "лабинск": "Краснодарский край", 
    "тим ашевск": "Краснодарский край", 
    "тимашевск": "Краснодарский край", 
    "п. плодородный": "Краснодарский край", 
    "гулькевичевский": "Краснодарский край", 
    "новоукраинское": "Краснодарский край", 
    "знаменский": "Краснодарский край", 
    "выселки": "Краснодарский край", 
    "старовиличковская": "Краснодарский край", 
    "островского": "Краснодарский край", 
    "мостовской": "Краснодарский край", 
    "новотитаровская": "Краснодарский край", 
    "морозова": "Краснодарский край", 
    "анапская": "Краснодарский край", 
    "варенниковская": "Краснодарский край", 
    "парус": "Краснодарский край", 
    "молдавка": "Краснодарский край", 
    "калининская": "Краснодарский край", 
    "виноградный": "Краснодарский край", 
    "лен инградская": "Краснодарский край", 
    "усть-лабинск": "Краснодарский край", 
    "васюринская": "Краснодарский край", 
    "фадеева": "Краснодарский край", 
    "солдатских матерей": "Краснодарский край", 
    "горячий ключ": "Краснодарский край", 
    "новонабережная": "Краснодарский край", 
    "ильский": "Краснодарский край", 
    "коммунистическая": "Краснодарский край", 
    "парковая": "Краснодарский край", 
    "железнодорожная": "Краснодарский край", 
    "воровского": "Краснодарский край", 
    "пустошкина": "Краснодарский край", 
    "крымск": "Краснодарский край", 
    "тамань": "Краснодарский край", 
    "гоголя": "Краснодарский край", 
    "курганинский": "Краснодарский край", 
    "михайловская": "Краснодарский край", 
    "индустриальная": "Краснодарский край", 
    "карла маркса": "Краснодарский край", 
    "50 лет октября": "Краснодарский край", 
    "ейск": "Краснодарский край", 
    "раевская": "Краснодарский край", 
    "апшеронск": "Краснодарский край", 
    "ленинградская": "Краснодарский край", 
    "крутой": "Краснодарский край", 
    "победы": "Краснодарский край", 
    "славянск на кубани": "Краснодарский край", 
    "тбилисская": "Краснодарский край", 
    "гулькевичи": "Краснодарский край", 
    "ярославского": "Краснодарский край", 
    "ростовское шоссе": "Краснодарский край", 
    "старотитаровская": "Краснодарский край", 
    "цибанобалка": "Краснодарский край", 
    "депутатская": "Краснодарский край", 
    "космическая": "Краснодарский край", 
    "адмирала пустошкина": "Краснодарский край", 
    "курчанская": "Краснодарский край", 
    "свердлова": "Краснодарский край", 
    "авиационная": "Краснодарский край", 
    "трудобеликовский": "Краснодарский край", 
    "широкая щель": "Краснодарский край", 
    "анастасиевская": "Краснодарский край", 
    "ковтюха": "Краснодарский край", 
    "рыночная площадь": "Краснодарский край", 
    "запорожская": "Краснодарский край", 
    "батерейная": "Краснодарский край", 
    "50 лет вклксм": "Краснодарский край", 
    "новомышастовская": "Краснодарский край", 
    "совхозный": "Краснодарский край", 
    "сенной": "Краснодарский край", 
    "базарная": "Краснодарский край", 
    "старокорсунская": "Краснодарский край", 
    "медведовская": "Краснодарский край", 
    "торговая": "Краснодарский край",
    "новоалександровск": "Ставропольский край", 
    "лермонтов": "Ставропольский край", 
    "нефтекумск": "Ставропольский край", 
    "благодарный": "Ставропольский край", 
    "кочубеевское": "Ставропольский край", 
    "донское": "Ставропольский край", 
    "архангельское": "Ставропольский край", 
    "иноземцево": "Ставропольский край", 
    "преображенское": "Ставропольский край", 
    "солдато-александровское": "Ставропольский край", 
    "праковея": "Ставропольский край", 
    "новоселицкое": "Ставропольский край", 
    "рыздвяный": "Ставропольский край", 
    "левокумское": "Ставропольский край", 
    "новотроицкая": "Ставропольский край", 
    "винсады": "Ставропольский край", 
    "зеленокумск": "Ставропольский край", 
    "железноводск": "Ставропольский край", 
    "демино": "Ставропольский край", 
    "мел иоратор": "Ставропольский край", 
    "ж илноводск": "Ставропольский край", 
    "кочубея": "Ставропольский край", 
    "барсуковская": "Ставропольский край", 
    "каху н": "Кабардино-Балкарская Республика", 
    "ног ир": "Республика Северная Осетия — Алания", 
    "чегем": "Кабардино-Балкарская Республика", 
    "нарткала": "Кабардино-Балкарская Республика", 
    "самашки": "Чеченская Республика", 
    "пролетарское": "Ставропольский край", 
    "бисултанова": "Чеченская Республика", 
    "мухаммада али": "Чеченская Республика", 
    "санько": "Ставропольский край", 
    "германа угрюмова": "Чеченская Республика", 
    "базоркина": "Республика Ингушетия", 
    "цад аса": "Республика Дагестан", 
    "магомедали магомеджанова": "Республика Дагестан", 
    "колесникова": "Ставропольский край", 
    "д нт": "Ставропольский край", 
    "северная осетия": "Республика Северная Осетия — Алания", 
    "армянская": "Республика Северная Осетия — Алания", 
    "бамматюртовская": "Республика Дагестан", 
    "омарова": "Республика Дагестан", 
    "богратион": "Республика Дагестан", 
    "бабаевский": "Республика Дагестан", 
    "ш. каспийское": "Республика Дагестан", 
    "казпийск": "Республика Дагестан", 
    "буйнакского": "Республика Дагестан", 
    "каловская": "Республика Дагестан", 
    "гродный": "Чеченская Республика", 
    "минральные воды": "Ставропольский край", 
    "г ессентуки": "Ставропольский край", 
    "г. ессентуки": "Ставропольский край", 
    "нив инномыск": "Ставропольский край", 
    "касп ийск": "Республика Дагестан", 
    "зеленчу кская": "Карачаево-Черкесская Республика", 
    "ст. зеленчукская": "Карачаево-Черкесская Республика",
};


/* -------------------------------------------------------------
   2. Умная очистка строки
   ------------------------------------------------------------- */
function cleanAddress(raw: string): string {
  return raw
    .toLowerCase()
    .trim()

    // 1. Phones, markets, business types
    .replace(/\+?7[\s\(\)\d-]{10,15}/g, '')
    .replace(
      /\s+(рынок|центральный рынок|оптовый склад|маг\s*№?|маг\.?|зоо|пав|бут|ларек|зоомагазин|питомник|ип|ооо|снт|днт|массив|тер\.?|тк|сектор|автовокзал|тц|гипермаркет|супермаркет)\s+/gi,
      ' '
    )
    .replace(/^(питомник|ип|ооо)\s*"[^"]*"\s*,?\s*(.*)$/i, '$2')

    // 3. Specific common typos
    .replace(/г\s+(спб|санкт\s?петербург)/g, 'г спб')
    .replace(/г\s+снкт-?петербург/g, 'г спб')
    .replace(/спб\s*,?\s*(г\.?|пр\.?)/g, 'спб ')
    .replace(/калининрад|калиниград|калининградская\s*обл\.?/g, 'калининград')

    // 4. General abbreviations and artifacts
    .replace(/\d{6}[,\s]*/g, '') // postal codes
    .replace(/[,;]/g, ' ')
    .replace(/обл\.?/g, 'область')
    .replace(/край\.?/g, 'край')
    .replace(/респ\.?/g, 'республика')
    .replace(/авт\.?округ\.?/g, 'автономный округ')
    .replace(/р-н\b/g, 'район')
    .replace(/г\.?\s*/g, 'г ')
    .replace(/пос\.?\s*/g, 'пос ')
    .replace(/п\.?\s*/g, 'п ')
    .replace(/с\.?\s*/g, 'с ')
    .replace(/ст-?ца\s*/g, 'ст. ')
    .replace(/\s+/g, ' ');
}

/* -------------------------------------------------------------
   3. Основная функция
   ------------------------------------------------------------- */
export async function parseRussianAddress(address: string): Promise<ParsedAddress> {
  // --- Skip garbage input ---
  if (
    !address ||
    typeof address !== 'string' ||
    address.trim() === '' ||
    address.trim() === '0' ||
    /^строка\s*#\d+/i.test(address)
  ) {
    return { region: 'Адрес не записан', city: 'Адрес не записан' };
  }

  const clean = cleanAddress(address);

  // --- 1. Explicit region match (область/край/республика) ---
  const explicitPattern =
    /([а-яё\s-]+?(?:область|край|республика|автономная область|автономный округ|город федерального значения))/i;
  let region = 'Регион не определён';
  const explicitMatch = clean.match(explicitPattern);
  if (explicitMatch) {
    region = normalizeRegion(explicitMatch[1].trim());
  }

  // --- 2. City / Town / Village match ---
  const cityPatterns = [
    /г\s+([а-яё\s\-]+)/i,
    /ст\.?\s+([а-яё\s\-]+)/i,
    /пос\s+([а-яё\s\-]+)/i,
    /п\s+([а-яё\s\-]+)/i,
    /с\s+([а-яё\s\-]+)/i,
  ];
  let city = 'Не определён'; // FIX: Initialize city differently from region
  for (const pattern of cityPatterns) {
    const match = clean.match(pattern);
    if (match?.[1]) {
      let rawCity = match[1].trim();
      // Cut off everything after street/house/etc. markers
      const cutIndex = rawCity.search(/\s+(ул|д\.|р-?н|мкр\.?|пер|б-р|пр-?кт|дом|кв|пав|тел|\+?7)/i);
      if (cutIndex > 0) {
        rawCity = rawCity.substring(0, cutIndex);
      }
      city = rawCity
        .split(' ')
        .map(w => w.charAt(0).toUpperCase() + w.slice(1))
        .join(' ');
      break;
    }
  }

  // --- 3. Fallback to dictionary (word by word) ---
  if (region === 'Регион не определён') {
    const words = clean.split(' ');
    for (const word of words) {
      const key = word.replace(/[^а-яё\s-]/g, '').trim();
      if (!key) continue;
      
      const dictKey = key.replace(/\s+/g, '-');
      if (extendedRegionCenters[dictKey]) {
        region = extendedRegionCenters[dictKey];
        if (city === 'Не определён') { // FIX: Only update city if it hasn't been found yet
          city = dictKey
            .split('-')
            .map(p => p.charAt(0).toUpperCase() + p.slice(1))
            .join(' ');
        }
        break;
      }
    }
  }
  
  // FINAL FIX: If city was never found, but region was, use region as city (e.g., for Moscow)
  if (city === 'Не определён' && region !== 'Регион не определён') {
      city = region;
  }


  return { region, city };
}
